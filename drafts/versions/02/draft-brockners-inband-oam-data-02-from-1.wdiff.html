<html><head><title>wdiff draft-brockners-inband-oam-data-01.txt draft-brockners-inband-oam-data-02.txt</title></head><body>
<pre>




Network Working Group                                       F. Brockners
Internet-Draft                                               S. Bhandari
Intended status: Experimental                               C. Pignataro
Expires: <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                                               Cisco
                                                              H. Gredler
                                                            RtBrick Inc.
                                                                J. Leddy
                                                                 Comcast
                                                               S. Youell
                                                                    JMPC
                                                           <strike><font color='red'>July 18,</font></strike>
                                                              <strong><font color='green'>T. Mizrahi
                                                                 Marvell
                                                                D. Mozes
                                              Mellanox Technologies Ltd.
                                                             P. Lapukhov
                                                                Facebook
                                                                R. Chang
                                                       Barefoot Networks
                                                        October 30,</font></strong> 2016


                      Data Formats for <strike><font color='red'>In-band</font></strike> <strong><font color='green'>In-situ</font></strong> OAM
                   <strike><font color='red'>draft-brockners-inband-oam-data-01</font></strike>
                   <strong><font color='green'>draft-brockners-inband-oam-data-02</font></strong>

Abstract

   <strike><font color='red'>In-band</font></strike>

   <strong><font color='green'>In-situ</font></strong> operation, administration and maintenance (OAM) records
   operational and telemetry information in the packet while the packet
   traverses a path between two points in the network.  This document
   discusses the data types and data formats for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data
   records.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM data records can be embedded into a variety of
   transports such as NSH, Segment Routing, VXLAN-GPE, native IPv6 (via
   extension header), or IPv4.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM is to complement current
   out-of-band OAM mechanisms based on ICMP or other types of probe
   packets.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 1]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017.







<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 1]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike>

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions . . . . . . . . . . . . . . . . . . . . . . . . .   3
   3.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Data Types and Data Format  . . . . . . . . . . .   3
     3.1.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Tracing <strike><font color='red'>Option</font></strike> <strong><font color='green'>Options</font></strong> . . . . . . . . . . . . . . .   4
       3.1.1.  <strike><font color='red'>In-band OAM</font></strike>  <strong><font color='green'>Pre-allocated</font></strong> Trace <strike><font color='red'>Type and Node Data Element</font></strike> <strong><font color='green'>Option</font></strong>  . . . .   <strike><font color='red'>7</font></strike> <strong><font color='green'>. . . . . . . . .   6
       3.1.2.  Incremental Trace Option  . . . . . . . . . . . . . .   9
       3.1.3.  In-situ OAM node data element format  . . . . . . . .  11
       3.1.4.  Examples of In-situ OAM node data . . . . . . . . . .  14</font></strong>
     3.2.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Proof of Transit Option . . . . . . . . . . .  <strike><font color='red'>10</font></strike>  <strong><font color='green'>16</font></strong>
     3.3.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Edge-to-Edge Option . . . . . . . . . . . . .  <strike><font color='red'>11</font></strike>  <strong><font color='green'>18</font></strong>
   4.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Data Export . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>18</font></strong>
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>19</font></strong>
   6.  Manageability Considerations  . . . . . . . . . . . . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>19</font></strong>
   7.  Security Considerations . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>19</font></strong>
   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>19</font></strong>
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>13</font></strike>  <strong><font color='green'>19</font></strong>
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .  <strike><font color='red'>13</font></strike>  <strong><font color='green'>19</font></strong>
     9.2.  Informative References  . . . . . . . . . . . . . . . . .  <strike><font color='red'>13</font></strike>  <strong><font color='green'>20</font></strong>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>13</font></strike>  <strong><font color='green'>20</font></strong>

1.  Introduction

   This document defines data record types for <strike><font color='red'>"in-band"</font></strike> <strong><font color='green'>"in-situ"</font></strong> operation,
   administration, and maintenance (OAM).  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM records OAM
   information within the packet while the packet traverses a particular
   network domain.  The term <strike><font color='red'>"in-band"</font></strike> <strong><font color='green'>"in-situ"</font></strong> refers to the fact that the OAM



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 2]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


   data is added to the data packets rather than is being sent within
   packets specifically dedicated to OAM.  A discussion of the
   motivation and requirements for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM can be found in
   <strike><font color='red'>[draft-brockners-inband-oam-requirements].  In-band</font></strike>
   <strong><font color='green'>[I-D.brockners-inband-oam-requirements].  In-situ</font></strong> OAM is to
   complement "out-of-band" or "active" mechanisms such as ping or
   traceroute, or more recent active probing mechanisms as described in
   [I-D.lapukhov-dataplane-probe].  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM mechanisms can be
   leveraged where current out-of-band mechanisms do not apply or do not



<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 2]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike>
   offer the desired results, such as proving that a certain set of
   traffic takes a pre-defined path, SLA verification for the live data
   traffic, detailed statistics on traffic distribution paths in
   networks that distribute traffic across multiple paths, or scenarios
   where probe traffic is potentially handled differently from regular
   data traffic by the network devices.

   This document defines the data types and data formats for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
   data records.  The <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data records can be transported by a
   variety of transport protocols, including NSH, Segment Routing,
   VXLAN-GPE, IPv6, IPv4.  Encapsulation details for these different
   transport protocols are outside the scope of this document.

2.  Conventions

   Abbreviations used in this document:

   MTU:       Maximum Transmit Unit

   OAM:       Operations, Administration, and Maintenance

   SR:        Segment Routing

   SID:       Segment Identifier

   NSH:       Network Service Header

   SFC:       Service Function Chain

   TLV:       Type-Length-Value

   VXLAN-GPE: Virtual eXtensible Local Area Network, Generic Protocol
              Extension

3.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Data Types and Data Format

   This section defines <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data types and data formats of the
   data records required for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM.  The different uses of <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong>
   OAM require the definition of different types of data.  The <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong>
   OAM data format for the data being carried corresponds to the three



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 3]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


   main categories of <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data defined in
   <strike><font color='red'>[draft-brockners-inband-oam-requirements],</font></strike>
   <strong><font color='green'>[I-D.brockners-inband-oam-requirements],</font></strong> which are <strong><font color='green'>:</font></strong> edge-to-edge,
   per node, and for selected nodes only.

   Transport options for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data are found in
   <strike><font color='red'>[draft-brockners-inband-oam-transport].  In-band</font></strike>
   <strong><font color='green'>[I-D.brockners-inband-oam-transport].  In-situ</font></strong> OAM data is defined as
   options in Type-Length-Value (TLV) format.  The TLV format for




<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 3]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike> each
   of the three different types of <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data is defined in this
   document.

   <strike><font color='red'>In-band</font></strike>

   <strong><font color='green'>In-situ</font></strong> OAM is expected to be deployed in a specific domain rather
   than on the overall Internet.  The part of the network which employs
   <strike><font color='red'>in-band</font></strike>
   <strong><font color='green'>in situ</font></strong> OAM is referred to as <strike><font color='red'>"in-band</font></strike> <strong><font color='green'>the "in-situ</font></strong> OAM-domain".  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM
   data is added to a packet <strike><font color='red'>on</font></strike> <strong><font color='green'>upon</font></strong> entering the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM-domain and is
   removed from the packet when exiting the domain.  Within the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong>
   OAM-domain, the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data may be updated by network nodes that
   the packet traverses.  The device which adds <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data
   <strong><font color='green'>container</font></strong> to the packet <strong><font color='green'>to capture in-situ OAM data</font></strong> is called the <strike><font color='red'>"in-band</font></strike>
   <strong><font color='green'>"in-situ</font></strong> OAM encapsulating node", whereas the device which <strike><font color='red'>removed</font></strike> <strong><font color='green'>removes</font></strong>
   the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data <strong><font color='green'>container</font></strong> is referred to as the <strike><font color='red'>"in-
   band</font></strike> <strong><font color='green'>"in-situ</font></strong> OAM
   decapsulating node".  Nodes within the domain which are aware of <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-
   situ</font></strong> OAM data and read and/or write or process the <strike><font color='red'>in-
   band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data
   are called <strike><font color='red'>"in-band</font></strike> <strong><font color='green'>"in-situ</font></strong> OAM transit nodes".  Note that not every node in
   an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM domain needs to be an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM transit node.  For
   example, a Segment Routing deployment might require the segment
   routing path to be verified.  In that case, only the SR nodes would
   also be <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM transit nodes rather than all nodes.

3.1.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Tracing <strike><font color='red'>Option

   "In-band</font></strike> <strong><font color='green'>Options

   "In-situ</font></strong> OAM tracing data" is expected to be collected at every <strike><font color='red'>hop</font></strike> <strong><font color='green'>node</font></strong>
   that a packet traverses, i.e., in a typical deployment all nodes in
   an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM-domain would participate in <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM and thus be
   <strike><font color='red'>in-band</font></strike>
   <strong><font color='green'>in-situ</font></strong> OAM transit nodes, <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM encapsulating or <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
   decapsulating nodes.  The <strong><font color='green'>maximum</font></strong> network diameter of the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
   domain is assumed to be known.  <strike><font color='red'>For in-band OAM tracing, the in-band OAM
   encapsulating node allocates an array which</font></strike>

   <strong><font color='green'>To optimize hardware and software implementations tracing</font></strong> is <strong><font color='green'>defined
   as two separate options.  Any deployment MAY choose</font></strong> to <strike><font color='red'>store operational
   data retrieved from every node while</font></strike> <strong><font color='green'>configure and
   support one or both of</font></strong> the <strike><font color='red'>packet traverses</font></strike> <strong><font color='green'>following options.  An implementation of</font></strong>
   the <strike><font color='red'>domain.
   Every entry is to hold information for</font></strike> <strong><font color='green'>transport protocol that carries these in-situ OAM data MAY choose
   to support only one of the options.

   Pre-allocated Trace Option:  This trace option is defined as</font></strong> a <strike><font color='red'>particular in-band</font></strike>
      <strong><font color='green'>container of node-data elements with pre-allocated space for each
      node to populate its information.  This option is useful for
      software implementations where it is efficient to allocate the
      space once and index into the array to populate the data during



Brockners, et al.          Expires May 3, 2017                  [Page 4]

Internet-Draft          In-situ</font></strong> OAM
   <strike><font color='red'>transit</font></strike> <strong><font color='green'>Data Formats            October 2016


      transit.  The in-situ OAM encapsulating</font></strong> node <strike><font color='red'>that</font></strike> <strong><font color='green'>allocates the option
      header and sets the fields in the option header.  The in situ OAM
      encapsulating node allocates an array which</font></strong> is <strike><font color='red'>traversed by a packet.  In-band</font></strike> <strong><font color='green'>to store
      operational data retrieved from every node while the packet
      traverses the domain.  In-situ</font></strong> OAM transit nodes update the
      content of the array.  A pointer which is part of the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
      trace data points to the next empty slot in the array, which is
      where the next <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM transit node fills in its data.

   <strong><font color='green'>Incremental Trace Option:  This trace options is defined as a
      container of node-data elements where each node allocates and
      pushes its node data immediately following the option header.</font></strong>  The <strike><font color='red'>in-band</font></strike>
      <strong><font color='green'>number of node-data recorded and maximum number of node data that
      can be recorded are written into the option header.  This format
      of trace recording is useful for some of the hardware
      implementations as this eliminates the need for the transit
      network elements to read the full array in the option and allows
      for arbitrarily long packets as the MTU allows.  The in-situ OAM
      encapsulating node allocates the option header.  The in-situ OAM
      encapsulating node based on operational state and configuration
      sets the fields in the header to control how large the node data
      list can grow.  In-situ OAM transit nodes pushes its node data to
      the node data list and increments the number of node data records
      in the header.

   Every node data entry is to hold information for a particular in situ
   OAM transit node that is traversed by a packet.  The in-situ</font></strong> OAM
   decapsulating node removes the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data and process and/or
   export the metadata.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM data uses its own name-space for
   information such as node identifier or interface identifier.  This
   allows for a domain-specific definition and interpretation.  For
   example: In one case an interface-id could point to a physical
   interface (e.g., to understand which physical interface of an
   aggregated link is used when receiving or transmitting a packet)
   whereas in another case it could refer to a logical interface (e.g.,
   in case of tunnels).

   The following <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data is defined for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM tracing:




<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 4]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike>

   o  Identification of the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM node.  An <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM node
      identifier can match to a device identifier or a particular
      control point or subsystem within a device.

   o  Identification of the interface that a packet was received on.

   o  Identification of the interface that a packet was sent out on.





<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 5]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


   o  Time of day when the packet was processed by the node.  Different
      definitions of processing time are feasible and expected, though
      it is important that all devices of an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM domain follow
      the same definition.

   o  Generic data: Format-free information where syntax and semantic of
      the information is defined by the operator in a specific
      deployment.  For a specific deployment, all <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM nodes
      should interpret the generic data the same way.  Examples for
      generic <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data include geo-location information
      (location of the node at the time the packet was processed),
      buffer queue fill level or cache fill level at the time the packet
      was processed, or even a battery charge level.

   o  A mechanism to detect whether <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM trace data was added at
      every hop or whether certain hops in the domain weren't <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong>
      OAM transit nodes.

   The "Node data List" array in the packet is populated iteratively as
   the packet traverses the network, starting with the last entry of the
   array, i.e., "Node data List [n]" is the first entry to be populated,
   "Node data List [n-1]" is the second one, etc.

<strong><font color='green'>3.1.1.  Pre-allocated Trace Option</font></strong>



























Brockners, et al.          Expires <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                  [Page <strike><font color='red'>5]</font></strike> <strong><font color='green'>6]</font></strong>

Internet-Draft          <strike><font color='red'>In-band</font></strike>          <strong><font color='green'>In-situ</font></strong> OAM Data Formats               <strike><font color='red'>July</font></strike>            <strong><font color='green'>October</font></strong> 2016


   <strike><font color='red'>In-band</font></strike>


   <strong><font color='green'>In-situ</font></strong> OAM <strike><font color='red'>Tracing</font></strike> <strong><font color='green'>Pre-allocated Trace</font></strong> Option:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option Type  |  Opt Data Len | <strike><font color='red'>OAM-trace-type|</font></strike> Elements-left |    <strong><font color='green'>Reserved1  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         OAM-Trace-Type        |         Reserved2             |</font></strong>
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+&lt;-+
   |                                                               |  |
   |                        Node data List [0]                     |  |
   |                                                               |  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  D
   |                                                               |  a
   |                        Node data List [1]                     |  t
   |                                                               |  a
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                              .                                .  S
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  p
   |                                                               |  a
   |                        Node data List [n-1]                   |  c
   |                                                               |  e
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
   |                                                               |  |
   |                        Node data List [n]                     |  |
   |                                                               |  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+&lt;-+



   Option Type:  8-bit identifier of the type of option.  Option number
      is defined based on the encapsulation protocol.

   Opt Data Len:  8-bit unsigned integer.  Length of the Option Data
      field of this option, in octets.

   <strike><font color='red'>OAM-trace-type:</font></strike>

   <strong><font color='green'>Elements-left:  8-bit unsigned integer.  A pointer that indicates the
      next data recording point in the data space of the packet in
      octets.  It is the index into the "Node data List" array shown
      above.

   Reserved1:</font></strong>  8-bit <strong><font color='green'>unused field in this document and MUST be set to
      zero.

   OAM-trace-type:  16-bit</font></strong> identifier of a particular trace element
      variant.





<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 7]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


      The trace type value <strike><font color='red'>can be interpreted as</font></strike> <strong><font color='green'>is</font></strong> a bit field.  The following bit fields are
      defined in this document, with details on each field described in
      the <strike><font color='red'>next section.</font></strike> <strong><font color='green'>Section 3.1.3.</font></strong>  The order of packing the trace data in each
      Node-data element follows the bit order for setting each trace
      data element.  <strike><font color='red'>Only a valid combination of
      these fields defined in this document are valid in-band OAM-trace-
      types.</font></strike>

      Bit 0    When set indicates presence of <strong><font color='green'>Hop_Lim and</font></strong> node_id in the
               Node data.





<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 6]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike>

      Bit 1    When set indicates presence of ingress_if_id <strong><font color='green'>and
               egress_if_id</font></strong> in the Node data.

      Bit 2    When set indicates presence of <strike><font color='red'>egress_if_id</font></strike> <strong><font color='green'>timestamp seconds</font></strong> in the
               Node
               <strike><font color='red'>data.</font></strike> <strong><font color='green'>data</font></strong>

      Bit 3    When set indicates presence of timestamp <strong><font color='green'>nanoseconds</font></strong> in
               the Node data.

      Bit 4    When set indicates presence of <strong><font color='green'>transit delay in the Node
               data.

      Bit 5    When set indicates presence of</font></strong> app_data in the Node data.

      Bit <strike><font color='red'>5-7</font></strike> <strong><font color='green'>6 - 14</font></strong>  Undefined in this document.

      <strong><font color='green'>Bit 15   When set indicates wide data format for all the node data
               elements that are present.  When unset indicates short
               data format for all the node data elements that are
               present.</font></strong>

      Section <strike><font color='red'>3.1.1</font></strike> <strong><font color='green'>3.1.4</font></strong> describes the format of a number of trace types.
      <strike><font color='red'>Specifically, it exemplifies OAM-trace-types 0x00011111,
      0x00000111, 0x00001001, 0x00010001, and 0x00011001.

   Elements-left:  8-bit unsigned integer.  A pointer that indicates the
      next data recording point in the data space of the packet</font></strike>

   <strong><font color='green'>Reserved2:  16-bit unused field</font></strong> in
      <strike><font color='red'>octets.  It is the index into the "Node data List" array shown
      above.</font></strike> <strong><font color='green'>this document and MUST be set to
      zero.</font></strong>

   Node data List [n]:  Variable-length field.  The format of which is
      determined by the OAM Type representing the n-th Node data in the
      Node data List.  The Node data List is encoded starting from the
      last Node data of the path.  The first element of the node data
      list (Node data List [0]) contains the last node of the path while
      the last node data of the Node data List (Node data List[n])
      contains the first Node data of the path traced.  The index
      contained in "Elements-left" identifies the current active Node
      data to be populated.

<strike><font color='red'>3.1.1.  In-band</font></strike>







<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 8]

Internet-Draft          In-situ</font></strong> OAM <strike><font color='red'>Trace Type and Node</font></strike> Data <strike><font color='red'>Element

   An entry in the "Node data List" array can have different formats,
   following the needs</font></strike> <strong><font color='green'>Formats            October 2016


3.1.2.  Incremental Trace Option

   In-situ OAM Incremental Trace Option:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option Type  |  Opt Data Len | Maximum Length|    Flags      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         OAM Trace Type        |         Reserved              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                        Node data List [0]                     |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                        Node data List [1]                     |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                              .                                .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                        Node data List [n-1]                   |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                        Node data List [n]                     |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+



   Option Type:  8-bit identifier of the type of option.  Option number
      is defined based on the encapsulation protocol.

   Opt Data Len:  8-bit unsigned integer.  Length of the Option Data
      field of this option, in octets.

   Maximum Length:  8-bit unsigned integer.  This field specifies the
      maximum length of the node data list in octets.  Given that the
      sender knows the minimum path MTU, the sender can set the maximum
      of node data bytes allowed before exceeding the MTU.  Thus, a
      simple comparison between "Opt data Len" and "Max Length" allows
      to decide whether or not data could be added.

   Flags  8-bit field.  Following flags are defined:





Brockners, et al.          Expires May 3, 2017                  [Page 9]

Internet-Draft          In-situ OAM Data Formats            October 2016


      1  "Overflow" (O-bit) (least significant bit).  This bit is set by
         the network element if the number of records on the packet is
         at the maximum limit as specified by the packet: i.e., the
         packet is already "full" of telemetry information.  This is
         useful for transit nodes to ignore further processing of the
         option.  If inserting a new node data record would cause "Opt
         Data Len" to exceed "Max Length", no record is added and the
         overflow "O-bit" must be set to "1" in the header.

   OAM-trace-type:  16-bit identifier of a particular trace element
      variant.

      The trace type value is a bit field.  The following bit fields are
      defined in this document, with details on each field described in
      the Section 3.1.3.  The order of packing the trace data in each
      Node-data element follows the bit order for setting each trace
      data element.

      Bit 0    When set indicates presence of Hop_Lim and node_id in the
               Node data.

      Bit 1    When set indicates presence of ingress_if_id and
               egress_if_id in the Node data.

      Bit 2    When set indicates presence of timestamp seconds in the
               Node data

      Bit 3    When set indicates presence of timestamp nanoseconds in
               the Node data.

      Bit 4    When set indicates presence of transit delay in the Node
               data.

      Bit 5    When set indicates presence of app_data in the Node data.

      Bit 6    When set indicates presence of variable length Opaque
               State Snapshot field.

      Bit 7-14 Undefined in this draft.

      Bit 15   When set indicates wide data format for all the node data
               elements that are present.  When unset indicates short
               data format for all the node data elements that are
               present.

      Section 3.1.4 describes the format of a number of trace types.





Brockners, et al.          Expires May 3, 2017                 [Page 10]

Internet-Draft          In-situ OAM Data Formats            October 2016


   Reserved:  2 bytes unused field in this document and MUST be set to
      zero.

   Node data List [n]:  Variable-length field.  The format of which is
      determined by the OAM Type representing the n-th Node data in the
      Node data List.  The Node data List is encoded starting from the
      last Node data of the path.  The first element of the node data
      list (Node data List [0]) contains the last node of the path while
      the last node data of the Node data List (Node data List[n])
      contains the first Node data of the path traced.

3.1.3.  In-situ OAM node data element format

   The in-situ OAM node data elements are defined in 2 formats - short
   and wide that is selected by bit 15 in the OAM-trace-type field.  All
   the data records MUST be 4-byte aligned in both the formats.

   Data type and format for each of the data records in short format is
   shown below:

   Hop_Lim and node_id:  4-octet field defined as follows:

    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Hop_Lim     |              node_id                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Hop_Lim:  1-octet unsigned integer.  It is set to the Hop Limit
         value in the packet at the node that records this data.  Hop
         Limit information is used to identify the location of the node
         in the communication path.

      node_id:  3-octet unsigned integer.  Node identifier field to
         uniquely identify a node within in-situ OAM domain.  The
         procedure to allocate, manage and map the node_ids is beyond
         the scope of this document.

   ingress_if_id and egress_if_id:  4-octet field defined as follows:

    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     ingress_if_id             |         egress_if_id          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      ingress_if_id:  2-octet unsigned integer.  Interface identifier to
         record the ingress interface the packet was received on.





Brockners, et al.          Expires May 3, 2017                 [Page 11]

Internet-Draft          In-situ OAM Data Formats            October 2016


      egress_if_id:  2-octet unsigned integer.  Interface identifier to
         record the egress interface the packet is forwarded out of.

   timestamp seconds:  4-octet unsigned integer.  Absolute timestamp in
      seconds that specifies the time at which the packet was received
      by the node.  The format of this field is identical to the most
      significant 32 bits of 64 least significant bits of the
      [IEEE1588v2].  This truncated format consists of a 32-bit seconds
      field.  As defined in [IEEE1588v2], the timestamp specifies the
      number of seconds elapsed since 1 January 1970 00:00:00 according
      to the International Atomic Time (TAI).

    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       timestamp seconds                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   timestamp nanoseconds:  4-octet unsigned integer.  This timestamp
      specifies time in nanoseconds relative to wall clock time at which
      the packet was received by the node It is nanoseconds that are
      recorded in 32 least significant bits of absolute time as per
      [IEEE1588v2].  This fields allows for delay computation between
      any two points in the network.

    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       timestamp nanoseconds                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   transit delay:  4-octet unsigned integer.  It is the time in
      nanoseconds packet spent in transiting a node.  This can serve to
      give an indication of queuing delay at the node.

    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      transit delay                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   app_data:  4-octet placeholder which can be used by the node to add
      application specific data

   Data type and format for each of the elements in wide format follows
   when Most Significant Bit (MSB) i.e., bit 15 of OAM-Trace-Type is
   set:

   Hop_Lim and node_id:  8-octet field defined as follows:





Brockners, et al.          Expires May 3, 2017                 [Page 12]

Internet-Draft          In-situ OAM Data Formats            October 2016


    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Hop_Lim     |              node_id                          ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ~                         node_id (contd)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Hop_Lim:  1-octet unsigned integer.  It is set to the Hop Limit
         value in the packet at the node that records this data.  Hop
         Limit information is used to identify the location of the node
         in the communication path.

      node_id:  7-octet unsigned integer.  Node identifier field to
         uniquely identify a node within in-situ OAM domain.  The
         procedure to allocate, manage and map the node_ids is beyond
         the scope of this document.

   ingress_if_id and egress_if_id:  8-octet field defined as follows:

    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       ingress_if_id                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       egress_if_id                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      ingress_if_id:  4-octet unsigned integer.  Interface identifier to
         record the ingress interface the packet was received on.

      egress_if_id:  4-octet unsigned integer.  Interface identifier to
         record the egress interface the packet is forwarded out of.

   app_data:  8-octet placeholder which can be used by the node to add
      application specific data.

   Opaque State Snapshot:  Variable length field.  It allows the network
      element to store arbitrary state in the node data record, without
      a pre-defined schema.  The schema needs to made known to the
      analyzer by some out-of-band means.  The 24-bit "Schema Id" field
      in the record is supposed to let the analyzer know which
      particular schema to use, and it is expected to be configured on
      the network element by the operator.  This ID is expected to be
      configured on the device by the network operator.








Brockners, et al.          Expires May 3, 2017                 [Page 13]

Internet-Draft          In-situ OAM Data Formats            October 2016


       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Length      |                     Schema ID                 |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      |                                                               |
      |                        Opaque data                            |
      ~                                                               ~
      .                                                               .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Length:  1-octet unsigned integer.  It is the length</font></strong> of the <strong><font color='green'>Opaque
         data field that follows Schema Id.  It MUST always be</font></strong> a
         <strong><font color='green'>multiple of 4.

      Schema ID:  3-octet unsigned integer identifying the schema of
         Opaque data.

      Opaque data:  Variable length field.  This field is interpreted as
         specified by the schema identified by the Schema ID.

      The fields - timestamp seconds, timestamp nanoseconds and transit
      delay have the same format as defined in short format.

3.1.4.  Examples of In-situ OAM node data

   An entry in the "Node data List" array can have different formats,
   following the needs of the</font></strong> deployment.  Some deployments might only
   be interested in recording the node identifiers, whereas others might
   be interested in recording node identifier and timestamp.  The
   section defines different formats that an entry in "Node data List"
   can take.

   <strike><font color='red'>Node data has</font></strike>

   <strong><font color='green'>0x002B:  In-situ OAM-trace-type is 0x2B then</font></strong> the <strike><font color='red'>following format:</font></strike> <strong><font color='green'>format of node data
      is:</font></strong>














Brockners, et al.          Expires <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                 [Page <strike><font color='red'>7]</font></strike> <strong><font color='green'>14]</font></strong>

Internet-Draft          <strike><font color='red'>In-band</font></strike>          <strong><font color='green'>In-situ</font></strong> OAM Data Formats               <strike><font color='red'>July</font></strike>            <strong><font color='green'>October</font></strong> 2016


        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   <strike><font color='red'>Hop_Lim</font></strike>   <strong><font color='green'>Hop_Lim     |              node_id                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |     ingress_if_id             |         egress_if_id</font></strong>          |    <strike><font color='red'>&lt;trace-data elements packed as indicated   ~</font></strike>
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    <strike><font color='red'>~             by in-band OAM-trace-type bits&gt; .....             ~</font></strike>
       <strong><font color='green'>|                  timestamp nanoseconds                        |</font></strong>
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   <strike><font color='red'>0x00011111:  In-band</font></strike>
       <strong><font color='green'>|                            app_data                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   0x0003:  In-situ</font></strong> OAM-trace-type is <strike><font color='red'>0x00011111</font></strike> <strong><font color='green'>0x0003</font></strong> then the format <strike><font color='red'>of
      node data</font></strike> is:

        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   Hop_Lim     |              node_id                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |     ingress_if_id             |         egress_if_id          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       <strike><font color='red'>|                           timestamp                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                            app_data                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   0x00000111:  In-band</font></strike>



   <strong><font color='green'>0x0009:  In-situ</font></strong> OAM-trace-type is <strike><font color='red'>0x00000111</font></strike> <strong><font color='green'>0x0009</font></strong> then the format is:

        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   Hop_Lim     |              node_id                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |     <strike><font color='red'>ingress_if_id             |         egress_if_id</font></strike>                   <strong><font color='green'>timestamp nanoseconds</font></strong>                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+



   <strike><font color='red'>0x00001001:  In-band</font></strike>


   <strong><font color='green'>0x0021:  In-situ</font></strong> OAM-trace-type is <strike><font color='red'>0x00001001</font></strike> <strong><font color='green'>0x0021</font></strong> then the format is:

        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   Hop_Lim     |              node_id                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                           <strike><font color='red'>timestamp</font></strike>                            <strong><font color='green'>app_data</font></strong>                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   <strike><font color='red'>0x00010001:  In-band</font></strike>


   <strong><font color='green'>0x0029:  In-situ</font></strong> OAM-trace-type is <strike><font color='red'>0x00010001</font></strike> <strong><font color='green'>0x0029</font></strong> then the format is:







Brockners, et al.          Expires <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                 [Page <strike><font color='red'>8]</font></strike> <strong><font color='green'>15]</font></strong>

Internet-Draft          <strike><font color='red'>In-band</font></strike>          <strong><font color='green'>In-situ</font></strong> OAM Data Formats               <strike><font color='red'>July</font></strike>            <strong><font color='green'>October</font></strong> 2016


        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   Hop_Lim     |              node_id                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                    <strong><font color='green'>timestamp nanoseconds                      |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |</font></strong>                            app_data                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   <strike><font color='red'>0x00011001:  In-band</font></strike>


   <strong><font color='green'>0x104D:  In-situ</font></strong> OAM-trace-type is <strike><font color='red'>0x00011001</font></strike> <strong><font color='green'>0x104D</font></strong> then the format is:

        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   Hop_Lim     |              node_id                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         <strong><font color='green'>node_id(contd)                        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |</font></strong>                      timestamp <strong><font color='green'>seconds</font></strong>                        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                            <strike><font color='red'>app_data</font></strike>                    <strong><font color='green'>timestamp nanoseconds</font></strong>                      |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   <strike><font color='red'>Trace data elements in Node</font></strike>
       <strong><font color='green'>|   Length      |                     Schema Id                 |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |                                                               |
       |                        Opaque</font></strong> data <strike><font color='red'>are defined as follows:

   Hop_Lim:  1 octet Hop limit that is set to the TTL value in the
      packet at the node that records this data.

   node_id:  Node identifier node_id is a 3 octet field to uniquely
      identify a node within in-band OAM domain.  The procedure to
      allocate, manage and map the node_ids is beyond the scope of this
      document.

   ingress_if_id:  2 octet interface identifier to record the ingress
      interface the packet was received on.

   egress_if_id:  2 octet interface identifier to record the egress
      interface the packet is forwarded out of.

   timestamp:  4 octet timestamp when packet has been processed by the
      node.

   app_data:  4 octet placeholder which can be used by the node to add
      application specific data.

   Hop Limit information is used to identify the location of the node in
   the communication path.







Brockners, et al.       Expires January 19, 2017                [Page 9]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike>                            <strong><font color='green'>|
       ~                                                               ~
       .                                                               .
       .                                                               .
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></strong>


3.2.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Proof of Transit Option

   <strike><font color='red'>In-band</font></strike>

   <strong><font color='green'>In-situ</font></strong> OAM Proof of Transit data is to support the path or service
   function chain [RFC7665] verification use cases.  Proof-of-transit
   uses methods like nested hashing or nested encryption of the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong>
   OAM data or mechanisms such as Shamir's Secret Sharing Schema (SSSS).
   While details on how the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data for the proof of transit
   option is processed at <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM encapsulating, decapsulating and
   transit nodes are outside the scope of the document, all of these
   approaches share the need to uniquely identify a packet as well as
   iteratively operate on a set of information that is handed from node
   to node.  Correspondingly, two pieces of information are added as in-
   <strike><font color='red'>band</font></strike>
   <strong><font color='green'>situ</font></strong> OAM data to the packet:





<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 16]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


   o  Random: Unique identifier for the packet (e.g., 64-bits allow for
      the unique identification of 2^64 packets).

   o  Cumulative: Information which is handed from node to node and
      updated by every node according to a verification algorithm.

   <strike><font color='red'>In-band</font></strike>

   <strong><font color='green'>In-situ</font></strong> OAM Proof of Transit option:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option Type  |  Opt Data Len |  POT type = 0 <strike><font color='red'>|F|</font></strike> <strong><font color='green'>|P|</font></strong>  reserved   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+&lt;-+
   |                           Random                              |  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  P
   |                        Random(contd)                          |  O
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  T
   |                         Cumulative                            |  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
   |                         Cumulative (contd)                    |  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+&lt;-+



   Option Type:  8-bit identifier of the type of option.

   Opt Data Len:  8-bit unsigned integer.  Length of the Option Data
      field of this option, in octets.

   POT Type:  8-bit identifier of a particular POT variant that dictates
      the POT data <strike><font color='red'>that</font></strike> <strong><font color='green'>that is included.  This document defines POT Type 0:

      0: POT data</font></strong> is <strike><font color='red'>included.

      *</font></strike> <strong><font color='green'>a</font></strong> 16 Octet field as described <strike><font color='red'>below




Brockners, et al.       Expires January 19, 2017               [Page 10]

Internet-Draft          In-band OAM Data Formats               July 2016


   Flag (F):</font></strike> <strong><font color='green'>below.

   Profile to use (P):</font></strong>  1-bit.  Indicates which POT-profile is <strike><font color='red'>active. 0 means</font></strike> <strong><font color='green'>used to
      generate</font></strong> the
      <strike><font color='red'>even POT-profile is active, 1 means</font></strike> <strong><font color='green'>Cumulative.  Any node participating in POT will have
      a maximum of 2 profiles configured that drive</font></strong> the <strike><font color='red'>odd POT-profile</font></strike> <strong><font color='green'>computation of
      cumulative.  The two profiles are numbered 0, 1.  This bit conveys
      whether profile 0 or profile 1</font></strong> is <strike><font color='red'>active.</font></strike> <strong><font color='green'>used to compute the Cumulative.</font></strong>

   Reserved:  7-bit.  <strike><font color='red'>(Reserved Octet)</font></strike>  Reserved <strike><font color='red'>octet</font></strike> for future use.

   Random:  64-bit Per packet Random number.

   Cumulative:  64-bit Cumulative that is updated at specific nodes by
      processing per packet Random number field and configured
      parameters.




<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 17]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


   Note: Larger or smaller sizes of "Random" and "Cumulative" data are
   feasible and could be required for certain deployments (e.g.  in case
   of space constraints in the transport protocol used).  Future
   versions of this document will address different sizes of data for
   "proof of transit".

3.3.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Edge-to-Edge Option

   The <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM Edge-to-Edge Option is to carry data which is to be
   interpreted only by the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM encapsulating and <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
   decapsulating node, but not by <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM transit nodes.

   Currently only sequence numbers use the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM Edge-to-Edge
   option.  In order to detect packet loss, packet reordering, or packet
   duplication in an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM-domain, sequence numbers can be added
   to packets of a particular tube (see
   [I-D.hildebrand-spud-prototype]).  Each tube leverages a dedicated
   namespace for its sequence numbers.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Option Type  |  Opt Data Len | OAM-E2E-Type  |    reserved   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      E2E Option data format determined by iOAM-E2E-Type       <strike><font color='red'>|</font></strike>       <strong><font color='green'>~</font></strong>
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   Option Type:  8-bit identifier of the type of option.

   Opt Data Len:  8-bit unsigned integer.  Length of the Option Data
      field of this option, in octets.

   <strike><font color='red'>iOAM-E2E-Type:</font></strike>

   <strong><font color='green'>OAM-E2E-Type:</font></strong>  8-bit identifier of a particular <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in situ</font></strong> OAM E2E
      variant.





<strike><font color='red'>Brockners, et al.       Expires January 19, 2017               [Page 11]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike>

         0: E2E option data is a 64-bit sequence number added to a
         specific tube which is used to identify packet loss and
         reordering for that tube.

   Reserved:  8-bit.  (Reserved Octet) Reserved octet for future use.

4.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Data Export

   <strike><font color='red'>In-band</font></strike>

   <strong><font color='green'>In-situ</font></strong> OAM nodes collect information for packets traversing a domain
   that supports <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM.  The device at the domain edge (which
   could also be an end-host) which receives a packet with <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
   information chooses how to process the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data collected



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 18]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


   within the packet.  This decapsulating node can simply discard the
   information collected, can process the information further, or export
   the information using e.g., IPFIX.

   The discussion of <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data processing and export is left for
   a future version of this document.

5.  IANA Considerations

   IANA considerations will be added in a future version of this
   document.

6.  Manageability Considerations

   Manageability considerations will be addressed in a later version of
   this document..

7.  Security Considerations

   Security considerations will be addressed in a later version of this
   document.  For a discussion of security requirements of <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM,
   please refer to <strike><font color='red'>[draft-brockners-inband-oam-requirements].</font></strike> <strong><font color='green'>[I-D.brockners-inband-oam-requirements].</font></strong>

8.  Acknowledgements

   The authors would like to thank Eric Vyncke, Nalini Elkins, Srihari
   Raghavan, Ranganathan T S, Karthik Babu Harichandra Babu, Akshaya
   Nadahalli, <strong><font color='green'>LJ Wobker, Erik Nordmark,</font></strong> and Andrew Yourtchenko for the
   comments and advice.  This document leverages and builds on top of
   several concepts described in
   <strike><font color='red'>[draft-kitamura-ipv6-record-route].</font></strike> <strong><font color='green'>[I-D.kitamura-ipv6-record-route].</font></strong>  The
   authors would like to acknowledge the work done by the author Hiroshi
   Kitamura and people involved in writing it.







<strike><font color='red'>Brockners, et al.       Expires January 19, 2017               [Page 12]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike>

9.  References

9.1.  Normative References

   <strike><font color='red'>[draft-brockners-inband-oam-requirements]</font></strike>

   <strong><font color='green'>[I-D.brockners-inband-oam-requirements]</font></strong>
              Brockners, F., Bhandari, S., <strong><font color='green'>Dara, S., Pignataro, C.,
              Gredler, H., Leddy, J.,</font></strong> and S. <strike><font color='red'>Dara,</font></strike> <strong><font color='green'>Youell,</font></strong> "Requirements for <strike><font color='red'>in-band</font></strike>
              <strong><font color='green'>In-band</font></strong> OAM", <strong><font color='green'>draft-brockners-inband-oam-requirements-01
              (work in progress),</font></strong> July 2016.









<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 19]

Internet-Draft          In-situ OAM Data Formats            October 2016


   [IEEE1588v2]
              Institute of Electrical and Electronics Engineers,
              "1588-2008 - IEEE Standard for a Precision Clock
              Synchronization Protocol for Networked Measurement and
              Control Systems",  IEEE Std 1588-2008, 2008,
              &lt;http://standards.ieee.org/findstds/
              standard/1588-2008.html&gt;.</font></strong>

9.2.  Informative References

   <strike><font color='red'>[draft-brockners-inband-oam-transport]</font></strike>

   <strong><font color='green'>[I-D.brockners-inband-oam-transport]</font></strong>
              Brockners, F., Bhandari, S., Pignataro, C., <strike><font color='red'>and H.</font></strike> Gredler, <strike><font color='red'>"Encapsulations for in-band OAM", July 2016.

   [draft-brockners-proof-of-transit]
              Brockners, F., Bhandari, S.,</font></strike> <strong><font color='green'>H.,
              Leddy, J.,</font></strong> and S. <strike><font color='red'>Dara, "Proof of
              transit",</font></strike> <strong><font color='green'>Youell, "Encapsulations for In-band OAM
              Data", draft-brockners-inband-oam-transport-01 (work in
              progress),</font></strong> July 2016.

   <strike><font color='red'>[draft-kitamura-ipv6-record-route]
              Kitamura, H., "Record Route for IPv6 (PR6),Hop-by-Hop
              Option Extension", November 2000.

   [FD.io]    "Fast Data Project: FD.io", &lt;https://fd.io/&gt;.</font></strike>

   [I-D.hildebrand-spud-prototype]
              Hildebrand, J. and B. Trammell, "Substrate Protocol for
              User Datagrams (SPUD) Prototype", draft-hildebrand-spud-
              prototype-03 (work in progress), March 2015.

   <strong><font color='green'>[I-D.kitamura-ipv6-record-route]
              Kitamura, H., "Record Route for IPv6 (PR6) Hop-by-Hop
              Option Extension", draft-kitamura-ipv6-record-route-00
              (work in progress), November 2000.</font></strong>

   [I-D.lapukhov-dataplane-probe]
              Lapukhov, P. and r. remy@barefootnetworks.com, "Data-plane
              probe for in-band telemetry collection", draft-lapukhov-
              dataplane-probe-01 (work in progress), June 2016.

   <strike><font color='red'>[P4]       Kim, , "P4: In-band Network Telemetry (INT)", September
              2015.</font></strike>

   [RFC7665]  Halpern, J., Ed. and C. Pignataro, Ed., "Service Function
              Chaining (SFC) Architecture", RFC 7665,
              DOI 10.17487/RFC7665, October 2015,
              &lt;http://www.rfc-editor.org/info/rfc7665&gt;.

Authors' Addresses








<strike><font color='red'>Brockners, et al.       Expires January 19, 2017               [Page 13]

Internet-Draft          In-band OAM Data Formats               July 2016</font></strike>

   Frank Brockners
   Cisco Systems, Inc.
   Hansaallee 249, 3rd Floor
   DUESSELDORF, NORDRHEIN-WESTFALEN  40549
   Germany

   Email: fbrockne@cisco.com






<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 20]

Internet-Draft          In-situ OAM Data Formats            October 2016</font></strong>


   Shwetha Bhandari
   Cisco Systems, Inc.
   Cessna Business Park, Sarjapura Marathalli Outer Ring Road
   Bangalore, KARNATAKA 560 087
   India

   Email: shwethab@cisco.com


   Carlos Pignataro
   Cisco Systems, Inc.
   7200-11 Kit Creek Road
   Research Triangle Park, NC  27709
   United States

   Email: cpignata@cisco.com


   Hannes Gredler
   RtBrick Inc.

   Email: hannes@rtbrick.com


   John Leddy
   Comcast

   Email: John_Leddy@cable.comcast.com


   Stephen Youell
   JP Morgan Chase
   25 Bank Street
   London  E14 5JP
   United Kingdom

   Email: stephen.youell@jpmorgan.com


   <strong><font color='green'>Tal
   Marvell
   6 Hamada St.
   Yokneam  20692
   Israel

   Email: talmi@marvell.com</font></strong>





Brockners, et al.          Expires <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                 [Page <strike><font color='red'>14]</font></strike> <strong><font color='green'>21]

Internet-Draft          In-situ OAM Data Formats            October 2016


   David
   Mellanox Technologies Ltd.

   Email: davidm@mellanox.com


   Petr
   Facebook
   1 Hacker Way
   Menlo Park, CA  94025
   US

   Email: petr@fb.com


   Remy
   Barefoot Networks
   2185 Park Boulevard
   Palo Alto, CA  94306
   US































Brockners, et al.          Expires May 3, 2017                 [Page 22]</font></strong>
</pre>
</body></html>
