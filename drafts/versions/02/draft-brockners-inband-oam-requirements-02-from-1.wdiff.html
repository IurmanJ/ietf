<html><head><title>wdiff draft-brockners-inband-oam-requirements-01.txt draft-brockners-inband-oam-requirements-02.txt</title></head><body>
<pre>




Network Working Group                                       F. Brockners
Internet-Draft                                               S. Bhandari
Intended status: Informational                                   S. Dara
Expires: <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                                        C. Pignataro
                                                                   Cisco
                                                              H. Gredler
                                                            RtBrick Inc.
                                                                J. Leddy
                                                                 Comcast
                                                               S. Youell
                                                                    JMPC
                                                           <strike><font color='red'>July 18,</font></strike>
                                                                <strong><font color='green'>D. Mozes
                                              Mellanox Technologies Ltd.
                                                              T. Mizrahi
                                                                 Marvell
                                                             P. Lapukhov
                                                                Facebook
                                                                R. Chang
                                                       Barefoot Networks
                                                        October 30,</font></strong> 2016


                      Requirements for <strike><font color='red'>In-band</font></strike> <strong><font color='green'>In-situ</font></strong> OAM
               <strike><font color='red'>draft-brockners-inband-oam-requirements-01</font></strike>
               <strong><font color='green'>draft-brockners-inband-oam-requirements-02</font></strong>

Abstract

   This document discusses the motivation and requirements for including
   specific operational and telemetry information into data packets
   while the data packet traverses a path between two points in the
   network.  This method is referred to as <strike><font color='red'>"in-band"</font></strike> <strong><font color='green'>"in-situ"</font></strong> Operations,
   Administration, and Maintenance (OAM), given that the OAM information
   is carried with the data packets as opposed to in "out-of-band"
   packets dedicated to OAM.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In situ</font></strong> OAM complements other OAM
   mechanisms which use dedicated probe packets to convey OAM
   information.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.





<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 1]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017.






<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 1]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3
   2.  Conventions . . . . . . . . . . . . . . . . . . . . . . . . .   4
   3.  Motivation for <strike><font color='red'>In-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM  . . . . . . . . . . . . . . . . .   <strike><font color='red'>4</font></strike>   <strong><font color='green'>5</font></strong>
     3.1.  Path Congruency Issues with Dedicated OAM Packets . . . .   5
     3.2.  Results Sent to a System Other Than the Sender  . . . . .   <strike><font color='red'>5</font></strike>   <strong><font color='green'>6</font></strong>
     3.3.  Overlay and Underlay Correlation  . . . . . . . . . . . .   <strike><font color='red'>5</font></strike>   <strong><font color='green'>6</font></strong>
     3.4.  SLA Verification  . . . . . . . . . . . . . . . . . . . .   <strike><font color='red'>6</font></strike>   <strong><font color='green'>7</font></strong>
     3.5.  Analytics and Diagnostics . . . . . . . . . . . . . . . .   <strike><font color='red'>6</font></strike>   <strong><font color='green'>7</font></strong>
     3.6.  Frame Replication/Elimination Decision for Bi-casting
           /Active-active Networks . . . . . . . . . . . . . . . . .   7
     3.7.  Proof of Transit  . . . . . . . . . . . . . . . . . . . .   <strike><font color='red'>7</font></strike>   <strong><font color='green'>8</font></strong>
     3.8.  Use Cases . . . . . . . . . . . . . . . . . . . . . . . .   <strike><font color='red'>8</font></strike>   <strong><font color='green'>9</font></strong>
   4.  Considerations for <strike><font color='red'>In-band</font></strike> <strong><font color='green'>In-situ</font></strong> OAM  . . . . . . . . . . . . . . .   <strike><font color='red'>9</font></strike>  <strong><font color='green'>11</font></strong>
     4.1.  Type of <strike><font color='red'>information</font></strike> <strong><font color='green'>Information</font></strong> to <strike><font color='red'>be recorded</font></strike> <strong><font color='green'>Be Recorded</font></strong>  . . . . . . . . . . .  <strike><font color='red'>10</font></strike>  <strong><font color='green'>11</font></strong>
     4.2.  MTU and <strike><font color='red'>packet size</font></strike> <strong><font color='green'>Packet Size</font></strong> . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>10</font></strike>  <strong><font color='green'>11</font></strong>
     4.3.  Administrative <strike><font color='red'>boundaries</font></strike> <strong><font color='green'>Boundaries</font></strong> . . . . . . . . . . . . . . . .  <strike><font color='red'>11</font></strike>  <strong><font color='green'>12</font></strong>
     4.4.  Selective <strike><font color='red'>enablement</font></strike> <strong><font color='green'>Enablement</font></strong>  . . . . . . . . . . . . . . . . . .  <strike><font color='red'>11</font></strike>  <strong><font color='green'>13</font></strong>
     4.5.  Optimization of <strike><font color='red'>node</font></strike> <strong><font color='green'>Node</font></strong> and <strike><font color='red'>interface identifiers</font></strike> <strong><font color='green'>Interface Identifiers</font></strong>  . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>13</font></strong>
     4.6.  Loop <strike><font color='red'>communication path</font></strike> <strong><font color='green'>Communication Path</font></strong> (IPv6-specifics)  . . . . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>13</font></strong>
   5.  Requirements for <strike><font color='red'>In-band</font></strike> <strong><font color='green'>In-situ</font></strong> OAM Data Types . . . . . . . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>14</font></strong>
     5.1.  Generic Requirements  . . . . . . . . . . . . . . . . . .  <strike><font color='red'>12</font></strike>  <strong><font color='green'>14</font></strong>
     5.2.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Data with Per-hop Scope . . . . . . . . . . .  <strike><font color='red'>13</font></strike>  <strong><font color='green'>15</font></strong>
     5.3.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM with Selected Hop Scope . . . . . . . . . . .  <strike><font color='red'>14</font></strike>  <strong><font color='green'>16</font></strong>
     5.4.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM with End-to-end Scope . . . . . . . . . . . .  <strike><font color='red'>14</font></strike>  <strong><font color='green'>17



Brockners, et al.          Expires May 3, 2017                  [Page 2]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   6.  Security Considerations and Requirements  . . . . . . . . . .  <strike><font color='red'>15</font></strike>  <strong><font color='green'>17</font></strong>
     6.1.  <strong><font color='green'>General considerations  . . . . . . . . . . . . . . . . .  17
     6.2.</font></strong>  Proof of Transit  . . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>15</font></strike>  <strong><font color='green'>17</font></strong>
   7.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>16</font></strike>  <strong><font color='green'>18</font></strong>
   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>16</font></strike>  <strong><font color='green'>19</font></strong>
   9.  Informative References  . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>16</font></strike>  <strong><font color='green'>19</font></strong>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <strike><font color='red'>18




Brockners, et al.       Expires January 19, 2017                [Page 2]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>  <strong><font color='green'>21</font></strong>

1.  Introduction

   This document discusses requirements for <strike><font color='red'>"in-band"</font></strike> <strong><font color='green'>"in-situ"</font></strong> Operations,
   Administration, and Maintenance (OAM) mechanisms.  <strike><font color='red'>"In-band" OAM
   means</font></strike>  <strong><font color='green'>In this context,
   "in-situ OAM" refers</font></strong> to <strike><font color='red'>record OAM and</font></strike> <strong><font color='green'>the concept of directly encoding</font></strong> telemetry
   information within the data packet
   <strike><font color='red'>while the data packet</font></strike> <strong><font color='green'>as it</font></strong> traverses <strike><font color='red'>a</font></strike> <strong><font color='green'>the</font></strong> network or <strike><font color='red'>a particular network</font></strike>
   <strong><font color='green'>telemetry</font></strong> domain.  <strike><font color='red'>The term "in-band" refers</font></strike>  <strong><font color='green'>Mechanisms which add tracing or other types of
   telemetry information</font></strong> to the <strike><font color='red'>fact that the OAM and
   telemetry data is carried within</font></strike> <strong><font color='green'>regular</font></strong> data <strike><font color='red'>packets rather than being sent
   within packets specifically dedicated</font></strike> <strong><font color='green'>traffic, sometimes also
   referred</font></strong> to <strike><font color='red'>OAM.  In-band</font></strike> <strong><font color='green'>as "in-band"</font></strong> OAM
   <strike><font color='red'>mechanisms,</font></strike> <strong><font color='green'>can complement active, probe-based
   mechanisms such as ping or traceroute,</font></strong> which are sometimes <strike><font color='red'>also referred to</font></strike> <strong><font color='green'>considered</font></strong>
   as <strike><font color='red'>embedded network
   telemetry</font></strike> <strong><font color='green'>"out-of-band", because the messages</font></strong> are <strike><font color='red'>a current topic</font></strike> <strong><font color='green'>transported independently
   from regular data traffic.  In terms</font></strong> of <strike><font color='red'>discussion.  In-band network
   telemetry has been defined for P4 [P4].  The SPUD prototype
   [I-D.hildebrand-spud-prototype] uses a similar</font></strike> <strong><font color='green'>"active" or "passive" OAM,
   "in-situ" OAM can be considered a hybrid OAM type.  While no extra
   packets are sent, in-situ OAM adds information to the packets
   therefore cannot be considered passive.  In terms of the
   classification given in [RFC7799] in-situ OAM could be portrayed as
   "hybrid OAM, type 1".  "In-situ" mechanisms do not require extra
   packets to be sent and hence don't change the packet traffic mix
   within the network.  Traceroute and ping for example use ICMP
   messages: New packets are injected to get tracing information.  Those
   add to the number of messages in a network, which already might be
   highly loaded or suffering performance issues for a particular path
   or traffic type.

   A number of in-situ as well as in-band OAM mechanisms have been
   discussed, such as the INT spec for the P4 programming language [P4]
   or the SPUD prototype [I-D.hildebrand-spud-prototype].  The SPUD
   prototype uses a similar</font></strong> logic that allows network devices on the
   path between endpoints to participate explicitly in the tube outside
   the end-to-end context.  Even the IPv4 route-record option defined in
   [RFC0791] can be considered an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM mechanism.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>Per what was
   already stated, in-situ</font></strong> OAM complements "out-of-band" mechanisms such
   as ping or traceroute, or more recent active probing mechanisms, as
   described in [I-D.lapukhov-dataplane-probe].  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM mechanisms
   can be leveraged where current out-of-band mechanisms do not apply or
   do not offer the desired characteristics or requirements, such as
   proving that a certain set of traffic takes a pre-defined path,
   strict congruency <strong><font color='green'>between overlay and underlay transports</font></strong> is <strike><font color='red'>desired,</font></strike> <strong><font color='green'>in
   place,</font></strong> checking service level agreements for the live data traffic,
   detailed statistics <strike><font color='red'>on traffic distribution
   paths in networks that distribute traffic across multiple paths,</font></strike> <strong><font color='green'>or verification of path selections within a



Brockners, et al.          Expires May 3, 2017                  [Page 3]

Internet-Draft          In-situ OAM Requirements            October 2016


   domain,</font></strong> or scenarios where probe traffic is potentially handled
   differently from regular data traffic by the network devices.
   [RFC7276] presents an overview of OAM tools.

   Compared to probably the most basic example of <strike><font color='red'>"in-band</font></strike> <strong><font color='green'>"in-situ</font></strong> OAM" which is
   IPv4 route recording [RFC0791], an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM approach has the
   following capabilities:

   a.  A flexible data format to allow different types of information to
       be captured as part of an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM operation, including <strong><font color='green'>but</font></strong>
       not
       <strike><font color='red'>only</font></strike> <strong><font color='green'>limited to</font></strong> path tracing information, <strike><font color='red'>but additional</font></strike> operational and
       telemetry information such as timestamps, sequence numbers, or
       even generic data such as queue size, geo-location of the node
       that forwarded the packet, etc.

   b.  A data format to express node as well as link identifiers to
       record the path a packet takes with a fixed amount of added data.

   c.  The ability to <strike><font color='red'>detect</font></strike> <strong><font color='green'>determine</font></strong> whether any nodes were skipped while
       recording <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM information (i.e., <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM is not
       supported or not enabled on those nodes).





<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 3]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>

   d.  The ability to actively process information in the packet, for
       example to prove in a cryptographically secure way that a packet
       really took a pre-defined path using some traffic steering method
       such as service chaining or traffic engineering.

   e.  The ability to include OAM data beyond simple path information,
       such as timestamps or even generic data of a particular use case.

   f.  The ability to <strike><font color='red'>include</font></strike> <strong><font color='green'>carry in-situ</font></strong> OAM data in various different
       transport protocols.

2.  Conventions

   Abbreviations used in this document:

   ECMP:      Equal Cost Multi-Path

   MTU:       Maximum Transmit Unit

   NFV:       Network Function Virtualization

   OAM:       Operations, Administration, and Maintenance

   PMTU:      Path MTU

   SLA:       Service Level Agreement



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 4]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   SFC:       Service Function Chain

   SR:        Segment Routing

   This document defines <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> Operations, Administration, and
   Maintenance <strike><font color='red'>(in-band</font></strike> <strong><font color='green'>(in-situ</font></strong> OAM), as the subset in which OAM information is
   carried along with data packets.  This is as opposed to "out-of-band
   OAM", where specific packets are dedicated to carrying OAM
   information.

3.  Motivation for <strike><font color='red'>In-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM

   In several scenarios it is beneficial to make information about <strike><font color='red'>which</font></strike> <strong><font color='green'>the</font></strong>
   path a packet took through the network <strong><font color='green'>or through a network device as
   well as associated telemetry information</font></strong> available to the operator.
   This includes not only tasks like debugging, troubleshooting, as well
   as network planning and network optimization but also policy or
   service level agreement compliance checks.  This section discusses
   the motivation to introduce new methods for enhanced <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> network
   diagnostics.





<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 4]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>

3.1.  Path Congruency Issues with Dedicated OAM Packets

   <strike><font color='red'>Mechanisms which add tracing</font></strike>

   <strong><font color='green'>Packet scheduling algorithms, especially for balancing traffic across
   equal cost paths or links, often leverage</font></strong> information <strike><font color='red'>to the regular data traffic,
   sometimes also referred to as "in-band" or "passive OAM" can
   complement active, probe-based mechanisms such as ping or traceroute,
   which are sometimes considered as "out-of-band", because the messages
   are transported independently from regular data traffic.  "In-band"
   mechanisms do not require extra packets to be sent and hence don't
   change the packet traffic mix within the network.  Traceroute and
   ping for example use ICMP messages: New packets are injected to get
   tracing information.  Those add to the number of messages in a
   network, which already might be highly loaded or suffering
   performance issues for a particular path or traffic type.

   Packet scheduling algorithms, especially for balancing traffic across
   equal cost paths or links, often leverage information contained
   within</font></strike> <strong><font color='green'>contained
   within</font></strong> the packet, such as protocol number, IP-address or MAC-
   address.  Probe packets would thus either need to be sent from the
   exact same endpoints with the exact same parameters, or probe packets
   would need to be artificially constructed as "fake" packets and
   inserted along the path.  Both approaches are often not feasible from
   an operational perspective, be it that access to the end-system is
   not feasible, or that the diversity of parameters and associated
   probe packets to be created is simply too large.  An <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong>
   mechanism is an alternative in those cases.

   <strike><font color='red'>In-band</font></strike>

   <strong><font color='green'>In-situ</font></strong> mechanisms <strike><font color='red'>also don't suffer from implementations,</font></strike> <strong><font color='green'>are not impacted by differences in the handling of
   probe traffic compared to other data packets,</font></strong> where probe traffic is
   handled differently (and potentially forwarded differently) by a
   router than regular data traffic.  <strong><font color='green'>This obviously assumes that the
   addition of in-situ information does not change the forwarding
   behavior of the packet.  Note that in certain implementations, the
   addition information to a transport protocol changes the forwarding
   behavior.  IPv6 extension header processing is one example.  Some
   implementations process IPv6 packets with extension headers in the
   "slow" path of a router, as opposed to the "fast" path.






Brockners, et al.          Expires May 3, 2017                  [Page 5]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


3.2.  Results Sent to a System Other Than the Sender

   Traditional ping and traceroute tools return the OAM results to the
   sender of the probe.  Even when the ICMP messages that are used with
   these tools are enhanced, and additional telemetry is collected
   (e.g., ICMP Multi-Part [RFC4884] supporting MPLS information
   [RFC4950], Interface and Next-Hop Identification [RFC5837], etc.), it
   would be advantageous to separate the sending of an OAM probe from
   the receiving of the telemetry data.  In this context, it is <strike><font color='red'>desired</font></strike> <strong><font color='green'>helpful</font></strong>
   to <strike><font color='red'>not assume</font></strike> <strong><font color='green'>eliminate the requirement that</font></strong> there <strike><font color='red'>is</font></strike> <strong><font color='green'>be</font></strong> a <strike><font color='red'>bidirectional</font></strike> working <strong><font color='green'>bidirectional</font></strong>
   path.

3.3.  Overlay and Underlay Correlation

   Several network deployments leverage tunneling mechanisms to create
   overlay or service-layer networks.  Examples include VXLAN-GPE, GRE,
   or LISP.  One often observed attribute of overlay networks is that
   they do not offer the user of the overlay any insight into the
   underlay network.  This means that the path that a particular



<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 5]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>
   tunneled packet takes, nor other operational details such as the per-
   hop delay/jitter in the underlay are visible to the user of the
   overlay network, giving rise to diagnosis and debugging challenges in
   case of connectivity or performance issues.  The scope of OAM tools
   like ping or traceroute is limited to either the overlay or the
   underlay which means that the user of the overlay has typically no
   access to OAM in the underlay, unless specific operational procedures
   are put in place.  With <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM the operator of the underlay can
   offer details of the connectivity in the underlay to the user of the
   overlay.  <strong><font color='green'>This could include the ability to find out which underlay
   elements are shared by overlays and ability to know which overlays
   are mapped to the same underlay elements.  Deployment dependent
   underlay transit nodes can be configured to update OAM information in
   the overlay transport encapsulation.</font></strong>  The operator of the egress
   tunnel router could choose to share the recorded information about
   the path with the user of the overlay.

   Coupled with mechanisms such as Segment Routing (SR)
   [I-D.ietf-spring-segment-routing], overlay network and underlay
   network can be more tightly coupled: The user of the overlay has
   detailed diagnostic information available in case of failure
   conditions.  The user of the overlay can also use the path recording
   information as input to traffic steering or traffic engineering
   mechanisms, to for example achieve path symmetry for the traffic
   between two endpoints.  [I-D.brockners-lisp-sr] is an example for how
   these methods can be applied to LISP.

<strike><font color='red'>3.4.  SLA</font></strike>






<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 6]

Internet-Draft          In-situ OAM Requirements            October 2016


3.4.  SLA</font></strong> Verification

   <strike><font color='red'>In-band</font></strike>

   <strong><font color='green'>In-situ</font></strong> OAM can help users of an overlay-service to verify that
   negotiated SLAs for the real traffic are met by the underlay network
   provider.  Different from solutions which rely on active probes to
   test an SLA, <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM based mechanisms avoid wrong interpretations
   and "cheating", which can happen if the probe traffic that is used to
   perform SLA-check is prioritized by the network provider of the
   underlay.  <strong><font color='green'>In active/standby deployments in-situ OAM would only allow
   for SLA verification of the active path.</font></strong>

3.5.  Analytics and Diagnostics

   Network planners and operators benefit from knowledge of the actual
   traffic distribution in the network.  When deriving an overall
   network connectivity traffic matrix one typically needs to correlate
   data gathered from each individual <strike><font color='red'>devices</font></strike> <strong><font color='green'>device</font></strong> in the network.  If the
   path of a packet is recorded while the packet is forwarded, the
   entire path that a packet took through the network is available to
   the egress system.  This obviates the need to retrieve individual
   traffic statistics from every device in the network and correlate
   those statistics, or employ other mechanisms such as leveraging
   traffic engineering with null-bandwidth tunnels just to retrieve the
   appropriate statistics to generate the traffic matrix.





<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 6]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>

   In addition, with individual path tracing, information is available
   at packet level granularity, rather than only at aggregate level - as
   is usually the case with IPFIX-style methods which employ flow-
   filters at the network elements.  Data-center networks which use
   equal-cost multipath (ECMP) forwarding are one example where detailed
   statistics on flow distribution in the network are highly desired.
   If a network supports ECMP, one can create detailed statistics for
   the different paths packets take through the network at the egress
   system, without a need to correlate/aggregate statistics from every
   router in the system.  Transit devices are off-loaded from the task
   of gathering packet statistics.

   <strong><font color='green'>In high-speed networks one can leverage and benefit from packet-
   accurate measurements with for example hardware-accurate timestamping
   (i.e., nanosecond-level verification) to support optimized packet
   scheduling and queuing mechanisms.</font></strong>

3.6.  Frame Replication/Elimination Decision for Bi-casting/Active-
      active Networks

   Bandwidth- and power-constrained, time-sensitive, or loss-intolerant
   networks (e.g., networks for industry automation/control, health
   care) require efficient OAM methods to decide when to replicate



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 7]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   packets to a secondary path in order to keep the loss/error-rate for
   the receiver at a tolerable level - and also when to stop replication
   and eliminate the redundant flow.  Many <strike><font color='red'>IoT</font></strike> <strong><font color='green'>Internet of Things (IoT)</font></strong>
   networks are time sensitive and cannot leverage automatic
   retransmission requests (ARQ) to cope with transmission errors or
   lost packets.  Transmitting the data over multiple disparate paths
   (often called bi-casting or <strike><font color='red'>live-
   live)</font></strike> <strong><font color='green'>live-live)</font></strong> is a method used to reduce the
   error rate observed by the receiver.  <strike><font color='red'>TSN</font></strike>  <strong><font color='green'>Time sensitive networks (TSN)</font></strong>
   receive a lot of attention from the manufacturing industry as shown
   by a various standardization activities and industry forums being
   formed (see e.g., IETF 6TiSCH, IEEE P802.1CB, AVnu).

3.7.  Proof of Transit

   Several deployments use traffic engineering, policy routing, segment
   routing or Service Function Chaining (SFC) [RFC7665] to steer packets
   through a specific set of nodes.  In certain cases regulatory
   obligations or a compliance policy require to prove that all packets
   that are supposed to follow a specific path are indeed being
   forwarded across the exact set of nodes specified.  If a packet flow
   is supposed to go through a series of service functions or network
   nodes, it has to be proven that all packets of the flow actually went
   through the service chain or collection of nodes specified by the
   policy.  In case the packets of a flow weren't appropriately
   processed, a verification device would be required to identify the
   policy violation and take corresponding actions (e.g., drop or
   redirect the packet, send an alert etc.) corresponding to the policy.
   In today's deployments, the proof that a packet traversed a
   particular service chain is typically delivered in an indirect way:
   Service appliances and network forwarding are in different trust



<strike><font color='red'>Brockners, et al.       Expires January 19, 2017                [Page 7]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>
   domains.  Physical hand-off-points are defined between these trust
   domains (i.e., physical interfaces).  Or in other terms, in the
   "network forwarding domain" things are wired up in a way that traffic
   is delivered to the ingress interface of a service appliance and
   received back from an egress interface of a service appliance.  This
   "wiring" is verified and trusted.  The evolution to Network Function
   Virtualization (NFV) and modern service chaining concepts (using
   technologies such as LISP, NSH, Segment Routing, etc.) blurs the line
   between the different trust domains, because the hand-off-points are
   no longer clearly defined physical interfaces, but are virtual
   interfaces.  Because of that very reason, networks operators require
   that different trust layers not to be mixed in the same device.  For
   an NFV scenario a different proof is required.  Offering a proof that
   a packet traversed a specific set of service functions would allow
   network operators to move away from the above described indirect
   methods of proving that a service chain is in place for a particular
   application.




<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 8]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   Deployed service chains without the presence of a "proof of transit"
   mechanism are typically operated as fail-open system: The packets
   that arrive at the end of a service chain are processed.  Adding
   "proof of transit" <strike><font color='red'>capabilites</font></strike> <strong><font color='green'>capabilities</font></strong> to a service chain allows an operator
   to turn a fail-open system into a fail-close system, i.e.  packets
   that did not properly traverse the service chain can be blocked.

   A solution approach could be based on OAM data which is added to
   every packet for achieving Proof Of <strike><font color='red'>Transit.  The</font></strike> <strong><font color='green'>Transit(POT).The</font></strong> OAM data is
   updated at every hop and is used to verify whether a packet traversed
   all required nodes.  When the verifier receives each packet, it can
   validate whether the packet traversed the service chain correctly.
   The detailed mechanisms used for path verification along with the
   procedures applied to the OAM data carried in the packet for path
   verification are beyond the scope of this document.  Details are
   addressed in <strike><font color='red'>[draft-brockners-proof-of-transit].</font></strike> <strong><font color='green'>[I-D.brockners-proof-of-transit].</font></strong>  In this document the
   term "proof" refers to a discrete set of bits that represents an
   integer or string carried as OAM data.  The OAM data is used to
   verify whether a packet traversed the nodes it is supposed to
   traverse.

3.8.  Use Cases

   <strike><font color='red'>In-band</font></strike>

   <strong><font color='green'>In-situ</font></strong> OAM could be leveraged for several use cases, including:

   o  Traffic Matrix: Derive the network traffic matrix: Traffic for a
      given time interval between any two edge nodes of a given domain.
      Could be performed for all traffic or <strong><font color='green'>on a</font></strong> per <strike><font color='red'>QoS-class.





Brockners, et al.       Expires January 19, 2017                [Page 8]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike> <strong><font color='green'>Quality of Service
      (QoS) class.</font></strong>

   o  Flow Debugging: Discover which path(s) a particular set of traffic
      (identified by an n-tuple) takes in the network.  Such a procedure
      is particularly useful in case traffic is balanced across multiple
      paths, like with link aggregation (LACP) or equal cost multi-
      pathing (ECMP).

   o  Loss Statistics per Path: Retrieve loss statistics per flow and
      path in the network.

   o  Path Heat Maps: Discover highly utilized links in the network.

   o  Trend Analysis on Traffic Patterns: Analyze if (and if so how) the
      forwarding path for a specific set of traffic changes over time
      (can give hints to routing issues, unstable links etc.).

   o  Network Delay Distribution: Show delay distribution across network
      by node or links.  If enabled per application or for a specific




<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                  [Page 9]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


      flow then display the path taken along with the delay incurred at
      every hop.

   o  SLA Verification: Verify that a negotiated service level agreement
      (SLA), e.g., for packet drop rates or delay/jitter is conformed to
      by the actual traffic.

   o  Low-power Networks: Include application level OAM information
      (e.g., battery charge level, cache or buffer fill level) into data
      traffic to avoid sending extra OAM traffic which incur an extra
      cost on the devices.  Using the battery charge level as example,
      one could avoid sending extra OAM packets just to communicate
      battery health, and as such would save battery on sensors.

   o  Path Verification or Service Function Path Verification: Proof and
      verification of packets traversing check points in the network,
      where check points can be nodes in the network or service
      functions.

   o  Geo-location Policy: Network policy implemented based on which
      path packets took.  Example: Only if packets originated and stayed
      within the trading-floor department, access to specific
      applications or servers is granted.

<strike><font color='red'>4.  Considerations for In-band OAM

   The implementation of an in-band OAM mechanism needs to take several
   considerations into account, including administrative boundaries, how
   information is recorded, Maximum Transfer Unit (MTU), Path MTU
   discovery</font></strike>

   <strong><font color='green'>o  Device-level troubleshooting</font></strong> and <strike><font color='red'>packet size, etc.




Brockners, et al.       Expires January 19, 2017                [Page 9]

Internet-Draft          In-band OAM Requirements               July 2016


4.1.  Type of</font></strike> <strong><font color='green'>optimization: In many cases,
      network operators could benefit from</font></strong> information <strong><font color='green'>specific</font></strong> to <strike><font color='red'>be recorded

   The information gathered for in-band OAM can be categorized into
   three main categories: Information with</font></strike> a <strike><font color='red'>per-hop scope, such as path
   tracing;</font></strike>
      <strong><font color='green'>single device.  A non-exhaustive list of useful</font></strong> information <strike><font color='red'>which applies to</font></strike>
      <strong><font color='green'>includes: queue-depths, buffer utilization (either shared or per-
      port), packet latency measured from</font></strong> a <strike><font color='red'>specific set</font></strike> <strong><font color='green'>known starting point, packet
      latency introduced by a single device, and resource utilization
      (CPU, memory, link bandwidth)</font></strong> of <strike><font color='red'>nodes, such
   as path</font></strike> <strong><font color='green'>a given device</font></strong> or <strike><font color='red'>service chain</font></strike> <strong><font color='green'>link.  In some
      cases, this information changes over per-packet timescales (i.e.,
      nanoseconds) and as such it is extremely challenging to collect
      and report this info in an accurate and scalable manner.  By
      encoding the information from the forwarding element directly
      within a data packet (i.e., within the 'fast-path') this
      information can be added to some or all data packets and then
      collected and analyzed by human or machine tools.  This type of
      information is particularly valuable for troubleshooting low-level
      device errors as well as providing a knowledge feedback loop for
      network and device optimization.

   o  Custom network probing: Active network probing and in-situ OAM can
      be combined for customized and efficient network probing.  This
      could for example be a customized traceroute.






Brockners, et al.          Expires May 3, 2017                 [Page 10]

Internet-Draft          In-situ OAM Requirements            October 2016


4.  Considerations for In-situ OAM

   The implementation of an in-situ OAM mechanism needs to take several
   considerations into account, including administrative boundaries, how
   information is recorded, Maximum Transfer Unit (MTU), Path MTU
   discovery and packet size, etc.

4.1.  Type of Information to Be Recorded

   The information gathered for in-situ OAM can be categorized into
   three main categories: Information with a per-hop scope, such as path
   tracing; information which applies to a specific set of hops, such as
   path or service chain</font></strong> verification; information which only applies to
   the edges of a domain, such as sequence numbers.  <strong><font color='green'>Note that a single
   network device could comprise several in-situ OAM hops, for example
   in case one wants to trace the path of a packet through that device.</font></strong>

   o  "edge to edge": Information that needs to be shared between
      network edges (the "edge" of a network could either be a host or a
      domain edge device): Edge to edge data e.g., packet and octet
      count of data entering a well-defined domain and leaving it is
      helpful in building traffic matrix, sequence number (also called
      "path packet counters") is useful for the flow to detect packet
      loss.

   o  "selected hops": Information that applies to a specific set of
      nodes only.  In case of path verification, only the nodes which
      are "check points" are required to interpret and update the
      information in the packet.

   o  "per hop": Information that is gathered at every hop along the
      path a packet traverses within an administrative domain:

      *  Hop by Hop information e.g., Nodes visited for path tracing,
         Timestamps at each hop to find delays along the path

      *  Stats collection at each hop to optimize communication in
         resource constrained networks e.g., Battery, CPU, memory status
         of each node piggy backed in a data packet is useful in low
         power lossy networks where network nodes are mostly asleep and
         communication is expensive

4.2.  MTU and <strike><font color='red'>packet size</font></strike> <strong><font color='green'>Packet Size</font></strong>

   The recorded data at every hop <strike><font color='red'>may</font></strike> <strong><font color='green'>might</font></strong> lead to packet size exceeding
   the Maximum Transmit Unit (MTU).  <strike><font color='red'>Based on the transport protocol used
   MTU is discovered as a configuration parameter or Path MTU (PMTU) is
   discovered dynamically.  Example: IPv6 recommends PMTU discovery
   before data packets are sent to prevent packet fragmentation.  It
   specifies 1280 octets as the default PDU to be carried in a IPv6
   datagram.</font></strike>  A detailed discussion of the
   implications of oversized IPv6 header chains <strike><font color='red'>if</font></strike> <strong><font color='green'>is</font></strong> found in [RFC7112].




<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 11]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   The Path MTU restricts the amount of data that can be recorded for
   purpose of OAM within a data packet.  <strike><font color='red'>The</font></strike>

   <strong><font color='green'>If in-situ OAM data is inserted at the edge of the domain (e.g., by
   intermediate routers) then the MTU on all interfaces with the domain
   (MTU_INT) MUST be &gt;= the maximum MTU on any "external" facing
   interfaces (MTU_EXT) and the</font></strong> total size of <strong><font color='green'>in-situ OAM</font></strong> data to be
   recorded <strike><font color='red'>needs to</font></strike> <strong><font color='green'>MUST</font></strong> be <strike><font color='red'>preset</font></strike> <strong><font color='green'>&lt;= (MTU_INT - MTU_EXT).

   In-situ OAM comprises two approaches</font></strong> to <strike><font color='red'>avoid</font></strike> <strong><font color='green'>insert OAM data-records in
   the packets:

   o  Pre-allocated: In this case, the encapsulating node inserts empty
      data records into the packet to cover the entire domain.  The data
      records will be incrementally updated/filled as the packet
      progresses through the network.  With pre-allocation the</font></strong> packet
      size <strike><font color='red'>exceeding</font></strike> <strong><font color='green'>is only changed at</font></strong> the <strike><font color='red'>MTU.




Brockners, et al.       Expires January 19, 2017               [Page 10]

Internet-Draft          In-band OAM Requirements               July 2016


   It</font></strike> <strong><font color='green'>encapsulating node and</font></strong> is <strike><font color='red'>recommended to pre-calculate</font></strike> <strong><font color='green'>kept
      constant throughout the domain.  The pre-allocated approach is
      beneficial for software data-plane implementations where
      allocating the required space only once</font></strong> and <strike><font color='red'>configures network devices</font></strike> <strong><font color='green'>index into the array</font></strong>
      to
   <strike><font color='red'>limit</font></strike> <strong><font color='green'>populate</font></strong> the <strike><font color='red'>in-band OAM</font></strike> data <strong><font color='green'>during transit avoids copy operations at
      every hop.

   o  Incremental: Every node</font></strong> that <strong><font color='green'>desires to include in-situ OAM
      information extends the packet as needed.  The incremental
      approach</font></strong> is <strike><font color='red'>attached</font></strike> <strong><font color='green'>beneficial for hardware data-plane implementations as
      it eliminates the need for the transit nodes</font></strong> to <strong><font color='green'>read the full
      array and lookup the pointer in the option prior to updating the
      data record contents.

   The "incremental" or the "pre-allocated" approaches could even be
   combined in the same deployment - in which case two in-situ OAM
   headers would be present in the packet: One for the incremental
   approach and one for the pre-allocated approach.  In such</font></strong> a <strike><font color='red'>packet.</font></strike> <strong><font color='green'>case one
   would expect that nodes with a hardware data-plane would update the
   incremental header, whereas nodes with a software data-plane would
   process the pre-allocated header.</font></strong>

4.3.  Administrative <strike><font color='red'>boundaries</font></strike> <strong><font color='green'>Boundaries</font></strong>

   There are several challenges in enabling <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM in the public
   Internet as well as in corporate/enterprise networks across
   administrative domains, which include but are not limited to:

   o  Deployment dependent, the data fields that <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM requires as
      part of a specific transport protocol may not be supported across
      administrative boundaries.




<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 12]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   o  Current OAM implementations are often done in the slow path, i.e.,
      OAM packets are punted to router's CPU for processing.  This leads
      to performance and scaling issues and opens up routers for attacks
      such as Denial of Service (DoS) attacks.

   o  Discovery of network topology and details of the network devices
      across administrative boundaries may open up attack vectors
      compromising network security.

   o  Specifically on IPv6: At the administrative boundaries IPv6
      packets with extension headers are dropped for several reasons
      described in [RFC7872].

   The following considerations will be discussed in a future version of
   this document: If the packet is dropped due to the presence of the
   <strike><font color='red'>in-band</font></strike>
   <strong><font color='green'>in-situ</font></strong> OAM; If the policy failure is treated as feature disablement
   and any further recording is stopped but the packet itself is not
   dropped, it may lead to every <strike><font color='red'>node in the path to make this policy
   decision.

4.4.  Selective enablement

   Deployment dependent, in-band OAM could either be used for all, or
   only a subset of</font></strike> <strong><font color='green'>node in</font></strong> the <strike><font color='red'>overall traffic.</font></strike> <strong><font color='green'>path to make this policy
   decision.

4.4.  Selective Enablement

   The ability to selectively enable in-situ OAM is valuable.</font></strong>  While it <strike><font color='red'>might</font></strike>
   <strong><font color='green'>may</font></strong> be desirable to
   <strike><font color='red'>apply in-band OAM to</font></strike> <strong><font color='green'>enable data collection on</font></strong> all traffic <strike><font color='red'>and then selectively use the data
   gathered in case needed, it might</font></strike> <strong><font color='green'>or devices,
   this may</font></strong> not always be feasible.  <strike><font color='red'>Depending
   on the forwarding infrastructure used, in-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM <strike><font color='red'>can have an</font></strike> <strong><font color='green'>collection may also
   come with a performance</font></strong> impact
   <strike><font color='red'>on</font></strike> <strong><font color='green'>to</font></strong> forwarding <strike><font color='red'>performance.  The</font></strike> <strong><font color='green'>rates or feature
   capabilities, which may be acceptable in only some locations.  For
   example, the</font></strong> SPUD prototype <strike><font color='red'>for example</font></strike> uses the notion of "pipes" to describe
   the portion of the traffic that could be subject to in-path
   inspection.  Mechanisms to decide which traffic would be subject to <strike><font color='red'>in-band</font></strike>
   <strong><font color='green'>in-situ</font></strong> OAM are outside the scope of this document.






<strike><font color='red'>Brockners, et al.       Expires January 19, 2017               [Page 11]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>

4.5.  Optimization of <strike><font color='red'>node</font></strike> <strong><font color='green'>Node</font></strong> and <strike><font color='red'>interface identifiers</font></strike> <strong><font color='green'>Interface Identifiers</font></strong>

   Since packets have a finite maximum size, the data recording or
   carrying capacity of one packet in which the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM <strike><font color='red'>meta data</font></strike> <strong><font color='green'>metadata</font></strong> is
   present is limited.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM should use its own dedicated
   namespace (confined to the domain <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM operates in) to
   represent node and interface IDs to save space in the header.
   Generic representations of node and interface identifiers which are
   globally unique (such as a UUID) would consume significantly more
   bits of <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data.

4.6.  Loop <strike><font color='red'>communication path</font></strike> <strong><font color='green'>Communication Path</font></strong> (IPv6-specifics)

   When recorded data is required to be analyzed on a source node that
   issues a packet and inserts <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data, the recorded data needs
   to be carried back to the source node.



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 13]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   One way to carry the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM data back to the source is to
   utilize an ICMP Echo Request/Reply (ping) or ICMPv6 Echo Request/
   Reply (ping6) mechanism.  In order to run the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM mechanism
   appropriately on the ping/ping6 mechanism, the following two
   operations should be implemented by the ping/ping6 target node:

   1.  All of the <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM fields would be copied from an Echo
       Request message to an Echo Reply message.

   2.  The Hop Limit field of the IPv6 header of these messages would be
       copied as a continuous sequence.  Further considerations are
       addressed in a future version of this document.

5.  Requirements for <strike><font color='red'>In-band</font></strike> <strong><font color='green'>In-situ</font></strong> OAM Data Types

   The above discussed use cases require different types of <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
   data.  This section details requirements for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM derived from
   the discussion above.

5.1.  Generic Requirements

   REQ-G1:  Classification: It should be possible to enable <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
            on a selected set of <strike><font color='red'>traffic.</font></strike> <strong><font color='green'>traffic (e.g., per interface, based on
            an access control list specifying a specific set of traffic,
            etc.).</font></strong>  The selected set of traffic can also be all traffic.

   REQ-G2:  Scope: If <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM is used only within a specific domain,
            provisions need to be put in place to ensure that <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong>
            OAM data stays within the specific domain only.

   REQ-G3:  Transport independence: Data formats for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM shall
            be defined in a transport independent way.  <strike><font color='red'>In-band OAM



Brockners, et al.       Expires January 19, 2017               [Page 12]

Internet-Draft          In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM <strike><font color='red'>Requirements               July 2016</font></strike>
            applies to a variety of transport protocols.  Encapsulations
            should be defined how the generic data formats are carried
            by a specific protocol.

   REQ-G4:  Layering: It should be possible to have <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM
            information for different transport protocol layers be
            present in several fields within a single packet.  <strike><font color='red'>This
            could for example be</font></strike>  <strong><font color='green'>This
            could for example be the case when tunnels are employed and
            in-situ OAM information is to be gathered for both the
            underlay as well as the overlay network.  Layering support
            should not be limited to just underlay and overlay, but
            include more than two layers.

   REQ-G5:  MTU size: With in-situ OAM information added, packets MUST
            not become larger than the path MTU.




Brockners, et al.          Expires May 3, 2017                 [Page 14]

Internet-Draft          In-situ OAM Requirements            October 2016


               REQ-G5.1: If due to some reason a packet which contains
               in situ OAM data record cannot be forwarded due to the
               presence of in-situ OAM data records, the node SHOULD
               remove the in situ OAM data records and forward the
               packet, rather than drop the entire packet.

               REQ-G5.2: If</font></strong> the <strike><font color='red'>case when tunnels are employed and
            in-band</font></strike> <strong><font color='green'>encapsulating router is unable to insert
               in-situ</font></strong> OAM <strike><font color='red'>information</font></strike> <strong><font color='green'>data records into a packet, e.g., due to MTU
               issues, even though it</font></strong> is <strong><font color='green'>configured</font></strong> to <strike><font color='red'>be gathered for both</font></strike> <strong><font color='green'>do so, it should
               use some operational means to inform</font></strong> the
            <strike><font color='red'>underlay as well as</font></strike> <strong><font color='green'>operator (e.g.,
               syslog) about</font></strong> the <strike><font color='red'>overlay network.

   REQ-G5:  MTU size: With in-band</font></strike> <strong><font color='green'>inability to add in-situ</font></strong> OAM <strike><font color='red'>information added, packets</font></strike> <strong><font color='green'>data
               records.  Even if the in-situ OAM encapsulating node
               fails to add in-situ OAM data records, it</font></strong> should
            <strike><font color='red'>not become larger than</font></strike> <strong><font color='green'>forward
               the packet normally.

               REQ-G5.3: MTU size consideration for in-situ OAM MUST
               take domain specifics into account, e.g., changes of</font></strong> the
               <strong><font color='green'>domain topology due to</font></strong> path <strike><font color='red'>MTU.</font></strike> <strong><font color='green'>protection mechanisms might
               extend the hop count of a path etc.</font></strong>

   REQ-G6:  Data <strike><font color='red'>Structure Reusability:</font></strike> <strong><font color='green'>structure reuse:</font></strong> The data types and data formats
            defined and used for <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM ought to be reusable for
            out-of-band OAM telemetry as well.

   <strong><font color='green'>REQ-G7:  Data records format: It is desirable that the format of in-
            situ OAM data-records leverages already defined data formats
            for OAM as much as feasible.

   REQ-G8:  Combination with active OAM mechanisms: In-situ OAM should
            be useable for active network probing, like for example a
            customized version of traceroute.  Decapsulating in-situ OAM
            nodes may have an ability to send the in-situ OAM
            information retrieved from the packet back to the source
            address of the packet or to the encapsulating node.</font></strong>

5.2.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM Data with Per-hop Scope

   REQ-H1:  Missing nodes detection: Data shall be present that allows a
            node to detect whether all nodes that <strike><font color='red'>should</font></strike> <strong><font color='green'>might</font></strong> participate in
            <strike><font color='red'>in-band</font></strike>
            <strong><font color='green'>in-situ</font></strong> OAM operations have indeed participated.

   REQ-H2:  Node, instance or device identifier: Data shall be present
            that allows to retrieve the identity of the entity reporting
            telemetry information.  The entity can be a device, or a
            subsystem/component within a device.  The latter will allow
            for packet tracing within a device in much the same way as
            between devices.




<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 15]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   REQ-H3:  Ingress interface identifier: Data shall be present that
            allows the identification of the interface a particular
            packet was received from.  The interface can be a logical <strike><font color='red'>or</font></strike>
            <strong><font color='green'>and/or</font></strong> physical entity.

   REQ-H4:  Egress interface identifier: Data shall be present that
            allows the identification of the interface a particular
            packet was forwarded to.  Interface can be a logical or
            physical entity.

   REQ-H5:  Time-related requirements

            REQ-H5.1:  Delay: Data shall be present that allows to
                       retrieve the delay between two or more points of
                       interest within the system.  Those points can be
                       within the same device or on different devices.




<strike><font color='red'>Brockners, et al.       Expires January 19, 2017               [Page 13]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>

            REQ-H5.2:  Jitter: Data shall be present that allows to
                       retrieve the jitter between two or more points of
                       interest within the system.  Those points can be
                       within the same device or on different devices.
                       <strong><font color='green'>Jitter can be derived from the different
                       timestamps gathered and does not necessarily need
                       to be an explicit data record.</font></strong>

            REQ-H5.3:  Wall-clock time: Data shall be present that
                       allows to retrieve the wall-clock time visited a
                       particular point of interest in the system.

            REQ-H5.4:  Time precision: <strike><font color='red'>The</font></strike> <strong><font color='green'>Time with different</font></strong> precision <strike><font color='red'>of the time related
                       data</font></strike>
                       should be <strike><font color='red'>configurable.</font></strike> <strong><font color='green'>supported.</font></strong>  Use-case dependent, the
                       required precision could e.g., be <strike><font color='red'>nano-
                       seconds, micro-seconds, milli-seconds,</font></strike> <strong><font color='green'>nanoseconds,
                       microseconds, milliseconds,</font></strong> or seconds.

   REQ-H6:  Generic data records (like e.g., GPS/Geo-location
            information): It should be possible to add user-defined OAM
            data at select hops to the packet.  The semantics of the
            data are defined by the user.

5.3.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM with Selected Hop Scope

   REQ-S1:  Proof of transit: Data shall be present which allows to
            securely prove that a packet has visited or ore several
            particular points of interest (i.e., a particular set of
            nodes).

            REQ-S1.1:  In case "Shamir's secret sharing scheme" is used
                       for proof of transit, two data records, "random"



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 16]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


                       and "cumulative" shall be present.  The number of
                       bits used for "random" and "cumulative" data
                       records can vary between deployments and should
                       thus be configurable.

            REQ-S1.2:  Enable a fail-open service chaining system to be
                       converted into a fail-closed service chaining
                       system.

5.4.  <strike><font color='red'>In-band</font></strike>  <strong><font color='green'>In-situ</font></strong> OAM with End-to-end Scope

   REQ-E1:  Sequence numbering:

            REQ-E1.1:  Reordering detection: It should be possible to
                       detect whether packets have been reordered while
                       traversing <strike><font color='red'>an in-band OAM domain.






Brockners, et al.       Expires January 19, 2017               [Page 14]

Internet-Draft          In-band</font></strike> <strong><font color='green'>an in situ</font></strong> OAM <strike><font color='red'>Requirements               July 2016</font></strike> <strong><font color='green'>domain.</font></strong>

            REQ-E1.2:  Duplicates detection: It should be possible to
                       detect whether packets have been duplicated while
                       traversing an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in situ</font></strong> OAM domain.

            REQ-E1.3:  Detection of packet drops: It should be possible
                       to detect whether packets have been dropped while
                       traversing an <strike><font color='red'>in-band</font></strike> <strong><font color='green'>in-situ</font></strong> OAM domain.

6.  Security Considerations and Requirements

<strong><font color='green'>6.1.  General considerations</font></strong>

   General Security considerations will be <strike><font color='red'>addressed</font></strike> <strong><font color='green'>expanded on</font></strong> in a later
   version of this document.  <strike><font color='red'>Security considerations for Proof of Transit alone
   are discussed below.

6.1.</font></strike>

   <strong><font color='green'>In-situ OAM is considered a "per domain" feature, where one or
   several operators decide on leveraging and configuring in-situ OAM
   according to their needs.  Still operators need to properly secure
   the in-situ OAM domain to avoid malicious configuration and use,
   which could include injecting malicious in-situ OAM packets into a
   domain.

6.2.</font></strong>  Proof of Transit

   Threat Model: Attacks on the deployments could be due to malicious
   administrators or accidental <strike><font color='red'>misconfigurations</font></strike> <strong><font color='green'>misconfiguration</font></strong> resulting in bypassing
   of certain nodes.  The solution approach should meet the following
   requirements:

   REQ-SEC1:  Sound Proof of Transit: A valid and verifiable proof that
              the packet definitively traversed through all the nodes as



<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 17]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


              expected.  Probabilistic methods to achieve this should be
              avoided, as the same could be exploited by an attacker.

   REQ-SEC2:  Tampering of meta data: An active attacker should not be
              able to insert or modify or delete meta data in whole or
              in parts and bypass few (or all) nodes.  Any deviation
              from the expected path should be accurately determined.

   REQ-SEC3:  Replay Attacks: A attacker (active/passive) should not be
              able to reuse the <strike><font color='red'>proof of transit</font></strike> <strong><font color='green'>POT</font></strong> bits in the packet by observing the
              OAM data in the packet, packet characteristics (like IP
              addresses, octets transferred, timestamps) or even the
              proof bits themselves.  The solution approach should
              consider usage of these parameters for deriving any
              secrets cautiously.  Mitigating replay attacks beyond a
              window of longer duration could be intractable to achieve
              with fixed number of bits allocated for proof.

   REQ-SEC4:  <strong><font color='green'>Pre-play Attacks: A active attacker should not be able to
              generate or reuse valid POT bits from legitimate packets,
              in order to prove to the verifier as valid packets.  This
              slight variant of replay attacks.  The attacker extracts
              POT bits from legitimate packets and ensure they do not
              reach the verifier.  Subsequently reuse those POT bits in
              crafted packets.

   REQ-SEC5:</font></strong>  Recycle Secrets: Any configuration of the secrets (like
              cryptographic keys, <strike><font color='red'>initialisation</font></strike> <strong><font color='green'>initialization</font></strong> vectors etc.) either in
              the controller or service functions should be
              <strike><font color='red'>reconfigurable.</font></strike> <strong><font color='green'>re-
              configurable.</font></strong>  Solution approach should enable controls,
              API calls etc. needed in order to perform such recycling.
              It is desirable to provide recommendations on the duration



<strike><font color='red'>Brockners, et al.       Expires January 19, 2017               [Page 15]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>
              of rotation cycles needed for the secure functioning of
              the overall system.

   <strike><font color='red'>REQ-SEC5:</font></strike>

   <strong><font color='green'>REQ-SEC6:</font></strong>  Secret storage and distribution: Secrets should be shared
              with the devices over secure channels.  Methods should be
              put in place so that secrets cannot be retrieved by <strike><font color='red'>non</font></strike> <strong><font color='green'>non-</font></strong>
              authorized personnel from the devices.

7.  IANA Considerations

   [RFC Editor: please remove this section prior to publication.]

   This document has no IANA actions.






<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 18]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


8.  Acknowledgements

   The authors would like to thank <strong><font color='green'>Jen Linkova, LJ Wobker,</font></strong> Eric Vyncke,
   Nalini Elkins, Srihari Raghavan, Ranganathan T S, Karthik Babu
   Harichandra Babu, Akshaya Nadahalli, <strong><font color='green'>Ignas Bagdonas, LJ Wobker, Erik
   Nordmark,</font></strong> and Andrew Yourtchenko for the comments and advice.  This
   document leverages and builds on top of several concepts described in
   <strike><font color='red'>[draft-kitamura-ipv6-record-route].</font></strike>
   <strong><font color='green'>[I-D.kitamura-ipv6-record-route].</font></strong>  The authors would like to
   acknowledge the work done by the author Hiroshi Kitamura and people
   involved in writing it.

9.  Informative References

   <strike><font color='red'>[draft-brockners-proof-of-transit]
              Brockners, F., Bhandari, S., and S. Dara, "Proof of
              transit", July 2016.

   [draft-kitamura-ipv6-record-route]
              Kitamura, H., "Record Route for IPv6 (PR6),Hop-by-Hop
              Option Extension", November 2000.</font></strike>

   [I-D.brockners-lisp-sr]
              Brockners, F., Bhandari, S., Maino, F., and D. Lewis,
              "LISP Extensions for Segment Routing", draft-brockners-
              lisp-sr-01 (work in progress), February 2014.

   <strong><font color='green'>[I-D.brockners-proof-of-transit]
              Brockners, F., Bhandari, S., Dara, S., Pignataro, C.,
              Leddy, J., and S. Youell, "Proof of Transit", draft-
              brockners-proof-of-transit-01 (work in progress), July
              2016.</font></strong>

   [I-D.hildebrand-spud-prototype]
              Hildebrand, J. and B. Trammell, "Substrate Protocol for
              User Datagrams (SPUD) Prototype", draft-hildebrand-spud-
              prototype-03 (work in progress), March 2015.

   [I-D.ietf-spring-segment-routing]
              Filsfils, C., Previdi, S., Decraene, B., Litkowski, S.,
              and R. Shakir, "Segment Routing Architecture", draft-ietf-
              spring-segment-routing-09 (work in progress), July 2016.



<strike><font color='red'>Brockners, et al.       Expires January 19, 2017               [Page 16]

Internet-Draft          In-band OAM Requirements               July 2016</font></strike>

   <strong><font color='green'>[I-D.kitamura-ipv6-record-route]
              Kitamura, H., "Record Route for IPv6 (PR6) Hop-by-Hop
              Option Extension", draft-kitamura-ipv6-record-route-00
              (work in progress), November 2000.</font></strong>

   [I-D.lapukhov-dataplane-probe]
              Lapukhov, P. and r. remy@barefootnetworks.com, "Data-plane
              probe for in-band telemetry collection", draft-lapukhov-
              dataplane-probe-01 (work in progress), June 2016.

   [P4]       Kim, , "P4: In-band Network Telemetry (INT)", September
              2015.





<strong><font color='green'>Brockners, et al.          Expires May 3, 2017                 [Page 19]

Internet-Draft          In-situ OAM Requirements            October 2016</font></strong>


   [RFC0791]  Postel, J., "Internet Protocol", STD 5, RFC 791,
              DOI 10.17487/RFC0791, September 1981,
              &lt;http://www.rfc-editor.org/info/rfc791&gt;.

   [RFC4884]  Bonica, R., Gan, D., Tappan, D., and C. Pignataro,
              "Extended ICMP to Support Multi-Part Messages", RFC 4884,
              DOI 10.17487/RFC4884, April 2007,
              &lt;http://www.rfc-editor.org/info/rfc4884&gt;.

   [RFC4950]  Bonica, R., Gan, D., Tappan, D., and C. Pignataro, "ICMP
              Extensions for Multiprotocol Label Switching", RFC 4950,
              DOI 10.17487/RFC4950, August 2007,
              &lt;http://www.rfc-editor.org/info/rfc4950&gt;.

   [RFC5837]  Atlas, A., Ed., Bonica, R., Ed., Pignataro, C., Ed., Shen,
              N., and JR. Rivers, "Extending ICMP for Interface and
              Next-Hop Identification", RFC 5837, DOI 10.17487/RFC5837,
              April 2010, &lt;http://www.rfc-editor.org/info/rfc5837&gt;.

   [RFC7112]  Gont, F., Manral, V., and R. Bonica, "Implications of
              Oversized IPv6 Header Chains", RFC 7112,
              DOI 10.17487/RFC7112, January 2014,
              &lt;http://www.rfc-editor.org/info/rfc7112&gt;.

   [RFC7276]  Mizrahi, T., Sprecher, N., Bellagamba, E., and Y.
              Weingarten, "An Overview of Operations, Administration,
              and Maintenance (OAM) Tools", RFC 7276,
              DOI 10.17487/RFC7276, June 2014,
              &lt;http://www.rfc-editor.org/info/rfc7276&gt;.

   [RFC7665]  Halpern, J., Ed. and C. Pignataro, Ed., "Service Function
              Chaining (SFC) Architecture", RFC 7665,
              DOI 10.17487/RFC7665, October 2015,
              &lt;http://www.rfc-editor.org/info/rfc7665&gt;.

   <strong><font color='green'>[RFC7799]  Morton, A., "Active and Passive Metrics and Methods (with
              Hybrid Types In-Between)", RFC 7799, DOI 10.17487/RFC7799,
              May 2016, &lt;http://www.rfc-editor.org/info/rfc7799&gt;.</font></strong>

   [RFC7872]  Gont, F., Linkova, J., Chown, T., and W. Liu,
              "Observations on the Dropping of Packets with IPv6
              Extension Headers in the Real World", RFC 7872,
              DOI 10.17487/RFC7872, June 2016,
              &lt;http://www.rfc-editor.org/info/rfc7872&gt;.







Brockners, et al.          Expires <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                 [Page <strike><font color='red'>17]</font></strike> <strong><font color='green'>20]</font></strong>

Internet-Draft          <strike><font color='red'>In-band</font></strike>          <strong><font color='green'>In-situ</font></strong> OAM Requirements               <strike><font color='red'>July</font></strike>            <strong><font color='green'>October</font></strong> 2016


Authors' Addresses

   Frank Brockners
   Cisco Systems, Inc.
   Hansaallee 249, 3rd Floor
   DUESSELDORF, NORDRHEIN-WESTFALEN  40549
   Germany

   Email: fbrockne@cisco.com


   Shwetha Bhandari
   Cisco Systems, Inc.
   Cessna Business Park, Sarjapura Marathalli Outer Ring Road
   Bangalore, KARNATAKA 560 087
   India

   Email: shwethab@cisco.com


   Sashank Dara
   Cisco Systems, Inc.
   Cessna Business Park, Sarjapura Marathalli Outer Ring Road
   Bangalore, KARNATAKA 560 087
   India

   Email: sadara@cisco.com


   Carlos Pignataro
   Cisco Systems, Inc.
   7200-11 Kit Creek Road
   Research Triangle Park, NC  27709
   United States

   Email: cpignata@cisco.com


   Hannes Gredler
   RtBrick Inc.

   Email: hannes@rtbrick.com


   John Leddy
   Comcast

   Email: John_Leddy@cable.comcast.com



Brockners, et al.          Expires <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                 [Page <strike><font color='red'>18]</font></strike> <strong><font color='green'>21]</font></strong>

Internet-Draft          <strike><font color='red'>In-band</font></strike>          <strong><font color='green'>In-situ</font></strong> OAM Requirements               <strike><font color='red'>July</font></strike>            <strong><font color='green'>October</font></strong> 2016


   Stephen Youell
   JP Morgan Chase
   25 Bank Street
   London  E14 5JP
   United Kingdom

   Email: stephen.youell@jpmorgan.com


   <strong><font color='green'>David Mozes
   Mellanox Technologies Ltd.

   Email: davidm@mellanox.com


   Tal Mizrahi
   Marvell
   6 Hamada St.
   Yokneam  20692
   Israel

   Email: talmi@marvell.com


   Petr Lapukhov
   Facebook
   1 Hacker Way
   Menlo Park, CA  94025
   USA

   URI:   petr@fb.com


   Remy Chang
   Barefoot Networks

   Email: remy@barefootnetworks.com</font></strong>














Brockners, et al.          Expires <strike><font color='red'>January 19,</font></strike> <strong><font color='green'>May 3,</font></strong> 2017                 [Page <strike><font color='red'>19]</font></strike> <strong><font color='green'>22]</font></strong>
</pre>
</body></html>
